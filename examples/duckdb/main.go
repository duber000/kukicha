// Generated by Kukicha v0.0.3 (requires Go 1.26+)
//
// Performance: GOEXPERIMENT=jsonv2 enables faster JSON parsing (2-10x improvement)

package main

import (
	"database/sql"
	"fmt"
	_ "github.com/marcboeker/go-duckdb"
)

//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:8
func mustExec(db *sql.DB, query string, args ...interface{}) sql.Result {
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:9
	result, err_1 := db.Exec(query, args...)
	if err_1 != nil {
		panic(fmt.Sprintf("exec failed: %v", err_1))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:10
	return result
}

//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:12
func main() {
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:14
	db, err_2 := sql.Open("duckdb", "")
	if err_2 != nil {
		panic(fmt.Sprintf("failed to open DuckDB: %v", err_2))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:15
	defer db.Close()
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:18
	mustExec(db, "CREATE TABLE sales (product VARCHAR, region VARCHAR, quantity INTEGER, price DOUBLE, sale_date DATE)")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:21
	ins := "INSERT INTO sales VALUES (?, ?, ?, ?, ?)"
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:22
	mustExec(db, ins, "Widget", "North", 100, 9.990000, "2024-01-15")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:23
	mustExec(db, ins, "Gadget", "South", 50, 24.990000, "2024-01-20")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:24
	mustExec(db, ins, "Widget", "South", 75, 9.990000, "2024-02-10")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:25
	mustExec(db, ins, "Gizmo", "North", 200, 4.990000, "2024-02-14")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:26
	mustExec(db, ins, "Gadget", "North", 30, 24.990000, "2024-03-01")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:27
	mustExec(db, ins, "Widget", "East", 120, 9.990000, "2024-03-05")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:28
	mustExec(db, ins, "Gizmo", "South", 180, 4.990000, "2024-03-10")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:29
	mustExec(db, ins, "Gadget", "East", 65, 24.990000, "2024-03-15")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:31
	fmt.Println("=== DuckDB Sales Analytics ===")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:32
	fmt.Println("")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:35
	fmt.Println("--- Revenue by Product ---")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:36
	rows, err_3 := db.Query("SELECT product, SUM(quantity) as total_qty, ROUND(SUM(quantity * price), 2) as revenue FROM sales GROUP BY product ORDER BY revenue DESC")
	if err_3 != nil {
		panic(fmt.Sprintf("query failed: %v", err_3))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:38
	for rows.Next() {
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:39
		product := ""
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:40
		totalQty := 0
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:41
		revenue := 0.000000
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:42
		if err_4 := rows.Scan(&product, &totalQty, &revenue); err_4 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_4))
		}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:43
		fmt.Println(fmt.Sprintf("  %v: %v units, $%v", product, totalQty, revenue))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:45
	rows.Close()
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:48
	fmt.Println("")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:49
	fmt.Println("--- Sales by Region ---")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:50
	var err_5 error
	rows, err_5 = db.Query("SELECT region, COUNT(*) as num_sales, ROUND(SUM(quantity * price), 2) as total_revenue FROM sales GROUP BY region ORDER BY total_revenue DESC")
	if err_5 != nil {
		panic(fmt.Sprintf("query failed: %v", err_5))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:52
	for rows.Next() {
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:53
		region := ""
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:54
		numSales := 0
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:55
		totalRevenue := 0.000000
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:56
		if err_6 := rows.Scan(&region, &numSales, &totalRevenue); err_6 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_6))
		}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:57
		fmt.Println(fmt.Sprintf("  %v: %v sales, $%v", region, numSales, totalRevenue))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:59
	rows.Close()
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:62
	fmt.Println("")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:63
	fmt.Println("--- Monthly Revenue Trend ---")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:64
	var err_7 error
	rows, err_7 = db.Query("SELECT STRFTIME(sale_date, '%Y-%m') as month, ROUND(SUM(quantity * price), 2) as revenue FROM sales GROUP BY month ORDER BY month")
	if err_7 != nil {
		panic(fmt.Sprintf("query failed: %v", err_7))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:66
	for rows.Next() {
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:67
		month := ""
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:68
		revenue := 0.000000
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:69
		if err_8 := rows.Scan(&month, &revenue); err_8 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_8))
		}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:70
		fmt.Println(fmt.Sprintf("  %v: $%v", month, revenue))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:72
	rows.Close()
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:75
	fmt.Println("")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:76
	fmt.Println("--- Top Sale per Region (Window Function) ---")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:77
	var err_9 error
	rows, err_9 = db.Query("SELECT product, region, ROUND(quantity * price, 2) as sale_value FROM sales QUALIFY ROW_NUMBER() OVER (PARTITION BY region ORDER BY quantity * price DESC) = 1 ORDER BY sale_value DESC")
	if err_9 != nil {
		panic(fmt.Sprintf("query failed: %v", err_9))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:79
	for rows.Next() {
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:80
		product := ""
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:81
		region := ""
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:82
		saleValue := 0.000000
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:83
		if err_10 := rows.Scan(&product, &region, &saleValue); err_10 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_10))
		}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:84
		fmt.Println(fmt.Sprintf("  %v: %v ($%v)", region, product, saleValue))
	}
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:86
	rows.Close()
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:88
	fmt.Println("")
//line /var/home/tluker/repos/go/kukicha/examples/duckdb/main.kuki:89
	fmt.Println("Analytics complete!")
}
