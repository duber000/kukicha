// Generated by Kukicha v0.0.1 (requires Go 1.25+)
//
// Performance options:
//   GOEXPERIMENT=greenteagc  - Green Tea GC (10-40% faster, default in Go 1.26)
//   GOEXPERIMENT=jsonv2      - Faster JSON parsing (2-10x improvement)

package main

import (
	"database/sql"
	"fmt"
	_ "github.com/marcboeker/go-duckdb"
)

func mustExec(db *sql.DB, query string, args ...interface{}) sql.Result {
	result, err_1 := db.Exec(query, args...)
	if err_1 != nil {
		panic(fmt.Sprintf("exec failed: %v", err_1))
	}
	return result
}

func main() {
	db, err_2 := sql.Open("duckdb", "")
	if err_2 != nil {
		panic(fmt.Sprintf("failed to open DuckDB: %v", err_2))
	}
	defer db.Close()
	mustExec(db, "CREATE TABLE sales (product VARCHAR, region VARCHAR, quantity INTEGER, price DOUBLE, sale_date DATE)")
	ins := "INSERT INTO sales VALUES (?, ?, ?, ?, ?)"
	mustExec(db, ins, "Widget", "North", 100, 9.990000, "2024-01-15")
	mustExec(db, ins, "Gadget", "South", 50, 24.990000, "2024-01-20")
	mustExec(db, ins, "Widget", "South", 75, 9.990000, "2024-02-10")
	mustExec(db, ins, "Gizmo", "North", 200, 4.990000, "2024-02-14")
	mustExec(db, ins, "Gadget", "North", 30, 24.990000, "2024-03-01")
	mustExec(db, ins, "Widget", "East", 120, 9.990000, "2024-03-05")
	mustExec(db, ins, "Gizmo", "South", 180, 4.990000, "2024-03-10")
	mustExec(db, ins, "Gadget", "East", 65, 24.990000, "2024-03-15")
	fmt.Println("=== DuckDB Sales Analytics ===")
	fmt.Println("")
	fmt.Println("--- Revenue by Product ---")
	rows, err_3 := db.Query("SELECT product, SUM(quantity) as total_qty, ROUND(SUM(quantity * price), 2) as revenue FROM sales GROUP BY product ORDER BY revenue DESC")
	if err_3 != nil {
		panic(fmt.Sprintf("query failed: %v", err_3))
	}
	for rows.Next() {
		product := ""
		totalQty := 0
		revenue := 0.000000
		if err_4 := rows.Scan(&product, &totalQty, &revenue); err_4 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_4))
		}
		fmt.Println(fmt.Sprintf("  %v: %v units, $%v", product, totalQty, revenue))
	}
	rows.Close()
	fmt.Println("")
	fmt.Println("--- Sales by Region ---")
	var err_5 error
	rows, err_5 = db.Query("SELECT region, COUNT(*) as num_sales, ROUND(SUM(quantity * price), 2) as total_revenue FROM sales GROUP BY region ORDER BY total_revenue DESC")
	if err_5 != nil {
		panic(fmt.Sprintf("query failed: %v", err_5))
	}
	for rows.Next() {
		region := ""
		numSales := 0
		totalRevenue := 0.000000
		if err_6 := rows.Scan(&region, &numSales, &totalRevenue); err_6 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_6))
		}
		fmt.Println(fmt.Sprintf("  %v: %v sales, $%v", region, numSales, totalRevenue))
	}
	rows.Close()
	fmt.Println("")
	fmt.Println("--- Monthly Revenue Trend ---")
	var err_7 error
	rows, err_7 = db.Query("SELECT STRFTIME(sale_date, '%Y-%m') as month, ROUND(SUM(quantity * price), 2) as revenue FROM sales GROUP BY month ORDER BY month")
	if err_7 != nil {
		panic(fmt.Sprintf("query failed: %v", err_7))
	}
	for rows.Next() {
		month := ""
		revenue := 0.000000
		if err_8 := rows.Scan(&month, &revenue); err_8 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_8))
		}
		fmt.Println(fmt.Sprintf("  %v: $%v", month, revenue))
	}
	rows.Close()
	fmt.Println("")
	fmt.Println("--- Top Sale per Region (Window Function) ---")
	var err_9 error
	rows, err_9 = db.Query("SELECT product, region, ROUND(quantity * price, 2) as sale_value FROM sales QUALIFY ROW_NUMBER() OVER (PARTITION BY region ORDER BY quantity * price DESC) = 1 ORDER BY sale_value DESC")
	if err_9 != nil {
		panic(fmt.Sprintf("query failed: %v", err_9))
	}
	for rows.Next() {
		product := ""
		region := ""
		saleValue := 0.000000
		if err_10 := rows.Scan(&product, &region, &saleValue); err_10 != nil {
			panic(fmt.Sprintf("scan failed: %v", err_10))
		}
		fmt.Println(fmt.Sprintf("  %v: %v ($%v)", region, product, saleValue))
	}
	rows.Close()
	fmt.Println("")
	fmt.Println("Analytics complete!")
}
