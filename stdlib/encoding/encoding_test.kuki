# Encoding Package Tests

petiole encoding_test

import "stdlib/encoding"
import "stdlib/test"
import "testing"

# Test Base64 encoding/decoding
func TestBase64Encoding(t reference testing.T)
    original := "Hello, World!" as list of byte

    encoded := encoding.Base64Encode(original)
    test.AssertNotEmpty(t, encoded)
    test.AssertEqual(t, encoded, "SGVsbG8sIFdvcmxkIQ==")

    decoded := encoding.Base64Decode(encoded) onerr panic "base64 decode failed"
    test.AssertEqual(t, decoded, original)

# Test Base64URL encoding/decoding
func TestBase64URLEncoding(t reference testing.T)
    original := "Hello, World!" as list of byte

    encoded := encoding.Base64URLEncode(original)
    test.AssertNotEmpty(t, encoded)
    test.AssertEqual(t, encoded, "SGVsbG8sIFdvcmxkIQ==")

    decoded := encoding.Base64URLDecode(encoded) onerr panic "base64url decode failed"
    test.AssertEqual(t, decoded, original)

# Test Base64Raw encoding
func TestBase64RawEncoding(t reference testing.T)
    original := "Hello, World!" as list of byte

    encoded := encoding.Base64RawEncode(original)
    test.AssertNotEmpty(t, encoded)
    test.AssertEqual(t, encoded, "SGVsbG8sIFdvcmxkIQ")

# Test Base64RawURL encoding
func TestBase64RawURLEncoding(t reference testing.T)
    original := "Hello, World!" as list of byte

    encoded := encoding.Base64RawURLEncode(original)
    test.AssertNotEmpty(t, encoded)
    test.AssertEqual(t, encoded, "SGVsbG8sIFdvcmxkIQ")

# Test Hex encoding/decoding
func TestHexEncoding(t reference testing.T)
    original := "Hello" as list of byte

    encoded := encoding.HexEncode(original)
    test.AssertNotEmpty(t, encoded)
    test.AssertEqual(t, encoded, "48656c6c6f")

    decoded := encoding.HexDecode(encoded) onerr panic "hex decode failed"
    test.AssertEqual(t, decoded, original)

# Test empty input
func TestEmptyInput(t reference testing.T)
    emptyBytes := empty list of byte

    encoded := encoding.Base64Encode(emptyBytes)
    test.AssertEqual(t, encoded, "")

    decoded := encoding.Base64Decode("") onerr panic "empty base64 decode failed"
    test.AssertEqual(t, len(decoded), 0)

    hexEncoded := encoding.HexEncode(emptyBytes)
    test.AssertEqual(t, hexEncoded, "")

    hexDecoded := encoding.HexDecode("") onerr panic "empty hex decode failed"
    test.AssertEqual(t, len(hexDecoded), 0)

# Test error cases
func TestErrorCases(t reference testing.T)
    _, err := encoding.Base64Decode("invalid!base64")
    test.AssertNotEmpty(t, err)

    _, err2 := encoding.HexDecode("abc")
    test.AssertNotEmpty(t, err2)

    _, err3 := encoding.HexDecode("abcdefg")
    test.AssertNotEmpty(t, err3)

# Test round-trip encoding/decoding
func TestRoundTrip(t reference testing.T)
    testData := list of byte{0, 1, 2, 3, 254, 255}

    b64Encoded := encoding.Base64Encode(testData)
    b64Decoded := encoding.Base64Decode(b64Encoded) onerr panic "base64 round-trip failed"
    test.AssertEqual(t, b64Decoded, testData)

    b64urlEncoded := encoding.Base64URLEncode(testData)
    b64urlDecoded := encoding.Base64URLDecode(b64urlEncoded) onerr panic "base64url round-trip failed"
    test.AssertEqual(t, b64urlDecoded, testData)

    hexEncoded := encoding.HexEncode(testData)
    hexDecoded := encoding.HexDecode(hexEncoded) onerr panic "hex round-trip failed"
    test.AssertEqual(t, hexDecoded, testData)

# Test special characters
func TestSpecialCharacters(t reference testing.T)
    special := "!@#$%^&*()" as list of byte

    b64Encoded := encoding.Base64Encode(special)
    b64Decoded := encoding.Base64Decode(b64Encoded) onerr panic "special chars base64 failed"
    test.AssertEqual(t, b64Decoded, special)

    hexEncoded := encoding.HexEncode(special)
    hexDecoded := encoding.HexDecode(hexEncoded) onerr panic "special chars hex failed"
    test.AssertEqual(t, hexDecoded, special)