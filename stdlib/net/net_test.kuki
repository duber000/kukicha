# Tests for Kukicha Standard Library - Net Package

petiole net_test

import "stdlib/net" as netutil
import "testing"

# Test IP parsing and CIDR operations
func TestIPAndCIDRHelpers(t reference testing.T)
    ip := netutil.ParseIP("10.0.0.1")
    if netutil.IsNil(ip)
        t.Fatalf("ParseIP should return valid IP")
    if not netutil.IsPrivate(ip)
        t.Errorf("10.0.0.1 should be private")

    loop := netutil.ParseIP("127.0.0.1")
    if not netutil.IsLoopback(loop)
        t.Errorf("Loopback detection failed")

    multicast := netutil.ParseIP("224.0.0.1")
    if not netutil.IsMulticast(multicast)
        t.Errorf("Multicast detection failed")

    cidr, err := netutil.ParseCIDR("192.0.2.0/24")
    if err != empty
        t.Fatalf("ParseCIDR failed: {err}")
    if not netutil.Contains(cidr, netutil.ParseIP("192.0.2.5"))
        t.Errorf("CIDR should contain 192.0.2.5")

    host, port, splitErr := netutil.SplitHostPort("example.com:8080")
    if splitErr != empty
        t.Fatalf("SplitHostPort failed: {splitErr}")
    if host != "example.com" or port != "8080"
        t.Errorf("SplitHostPort returned wrong parts")

    joined := netutil.JoinHostPort("example.com", "80")
    if joined != "example.com:80"
        t.Errorf("JoinHostPort returned '{joined}'")

    if netutil.IPString(multicast) != "224.0.0.1"
        t.Errorf("IPString returned wrong value")
