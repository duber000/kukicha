// Generated by Kukicha v0.0.4 (requires Go 1.26+)
//
// Performance: GOEXPERIMENT=jsonv2 enables faster JSON parsing (2-10x improvement)

package http

import (
	"errors"
	"fmt"
	"github.com/duber000/kukicha/stdlib/json"
	kukistring "github.com/duber000/kukicha/stdlib/string"
	"io"
	"net/http"
	"strconv"
)

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:17
func WithCSRF(handler any) any {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:18
	protection := http.NewCrossOriginProtection()
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:19
	h := handler.(http.Handler)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:20
	return protection.Handler(h)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:25
func Serve(addr string, handler any) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:26
	h := handler.(http.Handler)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:27
	return http.ListenAndServe(addr, h)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:35
func JSON(w http.ResponseWriter, value any) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:36
	w.Header().Set("Content-Type", "application/json")
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:37
	return json.MarshalWrite(w, value)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:42
func JSONStatus(w http.ResponseWriter, value any, status int) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:43
	w.Header().Set("Content-Type", "application/json")
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:44
	w.WriteHeader(status)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:45
	return json.MarshalWrite(w, value)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:49
func JSONCreated(w http.ResponseWriter, value any) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:50
	return JSONStatus(w, value, 201)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:55
func JSONError(w http.ResponseWriter, message string, status int) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:56
	w.Header().Set("Content-Type", "application/json")
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:57
	w.WriteHeader(status)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:58
	errorBody := map[string]string{"error": message}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:59
	return json.MarshalWrite(w, errorBody)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:63
func JSONBadRequest(w http.ResponseWriter, message string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:64
	return JSONError(w, message, 400)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:68
func JSONUnauthorized(w http.ResponseWriter, message string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:69
	return JSONError(w, message, 401)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:73
func JSONForbidden(w http.ResponseWriter, message string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:74
	return JSONError(w, message, 403)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:78
func JSONNotFound(w http.ResponseWriter, message string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:79
	return JSONError(w, message, 404)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:83
func JSONInternalError(w http.ResponseWriter, message string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:84
	return JSONError(w, message, 500)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:92
func ReadJSON(r *http.Request, target any) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:93
	return json.UnmarshalRead(r.Body, target)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:99
func ReadJSONAndClose(r *http.Request, target any) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:100
	defer r.Body.Close()
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:101
	return json.UnmarshalRead(r.Body, target)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:105
func GetQueryParam(r *http.Request, key string) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:106
	return r.URL.Query().Get(key)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:110
func GetQueryParamOr(r *http.Request, key string, defaultValue string) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:111
	value := r.URL.Query().Get(key)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:112
	if value == "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:113
		return defaultValue
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:114
	return value
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:119
func GetQueryInt(r *http.Request, key string) (int, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:120
	value := r.URL.Query().Get(key)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:121
	if value == "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:122
		return 0, errors.New(fmt.Sprintf("query parameter '%v' is required", key))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:123
	n, err := strconv.Atoi(value)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:124
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:125
		return 0, errors.New(fmt.Sprintf("query parameter '%v' must be an integer", key))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:126
	return n, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:131
func GetQueryIntOr(r *http.Request, key string, defaultValue int) int {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:132
	value := r.URL.Query().Get(key)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:133
	if value == "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:134
		return defaultValue
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:135
	n, err := strconv.Atoi(value)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:136
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:137
		return defaultValue
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:138
	return n
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:144
func GetQueryBool(r *http.Request, key string) (bool, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:145
	value := r.URL.Query().Get(key)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:146
	if value == "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:147
		return false, errors.New(fmt.Sprintf("query parameter '%v' is required", key))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:148
	lower := value
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:149
	if ((lower == "true") || (lower == "1")) || (lower == "yes") {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:150
		return true, nil
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:151
	if ((lower == "false") || (lower == "0")) || (lower == "no") {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:152
		return false, nil
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:153
	return false, errors.New(fmt.Sprintf("query parameter '%v' must be a boolean", key))
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:158
func GetQueryBoolOr(r *http.Request, key string, defaultValue bool) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:159
	value := r.URL.Query().Get(key)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:160
	if value == "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:161
		return defaultValue
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:162
	if ((value == "true") || (value == "1")) || (value == "yes") {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:163
		return true
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:164
	if ((value == "false") || (value == "0")) || (value == "no") {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:165
		return false
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:166
	return defaultValue
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:170
func GetHeader(r *http.Request, key string) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:171
	return r.Header.Get(key)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:175
func GetHeaderOr(r *http.Request, key string, defaultValue string) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:176
	value := r.Header.Get(key)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:177
	if value == "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:178
		return defaultValue
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:179
	return value
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:185
func NoContent(w http.ResponseWriter) {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:186
	w.WriteHeader(204)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:190
func Redirect(w http.ResponseWriter, r *http.Request, url string) {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:191
	http.Redirect(w, r, url, 302)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:195
func RedirectPermanent(w http.ResponseWriter, r *http.Request, url string) {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:196
	http.Redirect(w, r, url, 301)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:201
func Text(w http.ResponseWriter, content string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:202
	w.Header().Set("Content-Type", "text/plain; charset=utf-8")
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:203
	_, err := io.WriteString(w, content)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:204
	return err
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:208
func TextStatus(w http.ResponseWriter, content string, status int) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:209
	w.Header().Set("Content-Type", "text/plain; charset=utf-8")
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:210
	w.WriteHeader(status)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:211
	_, err := io.WriteString(w, content)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:212
	return err
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:217
func HTML(w http.ResponseWriter, content string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:218
	w.Header().Set("Content-Type", "text/html; charset=utf-8")
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:219
	_, err := io.WriteString(w, content)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:220
	return err
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:226
func IsGet(r *http.Request) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:227
	return (r.Method == "GET")
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:231
func IsPost(r *http.Request) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:232
	return (r.Method == "POST")
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:236
func IsPut(r *http.Request) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:237
	return (r.Method == "PUT")
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:241
func IsDelete(r *http.Request) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:242
	return (r.Method == "DELETE")
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:246
func IsPatch(r *http.Request) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:247
	return (r.Method == "PATCH")
}

//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:252
func MethodNotAllowed(w http.ResponseWriter, allowed ...string) {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:253
	parts := []string{}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:254
	for _, method := range allowed {
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:255
		parts = append(parts, method)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:256
	allowHeader := kukistring.Join(parts, ", ")
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:257
	w.Header().Set("Allow", allowHeader)
//line /var/home/tluker/repos/go/kukicha/stdlib/http/http.kuki:258
	w.WriteHeader(405)
}
