// Generated by Kukicha v0.0.1 (requires Go 1.25+)
//
// Performance options:
//   GOEXPERIMENT=greenteagc  - Green Tea GC (10-40% faster, default in Go 1.26)
//   GOEXPERIMENT=jsonv2      - Faster JSON parsing (2-10x improvement)

package parse

import (
	"encoding/csv"
	"encoding/json"
	"errors"
	"gopkg.in/yaml.v3"
	"strings"
)

func Json(data string) ([]byte, error) {
	return []byte(data), nil
}

func JsonLines(data string) ([]string, error) {
	lines := strings.Split(data, "\n")
	result := make([]string, 0, len(lines))
	for _, line := range lines {
		line = strings.TrimSpace(line)
		if len(line) > 0 {
			result = append(result, line)
		}
	}
	return result, nil
}

func JsonPretty(value any) ([]byte, error) {
	bytes, err := json.MarshalIndent(value, "", "  ")
	return bytes, err
}

func Csv(data string) ([][]string, error) {
	reader := csv.NewReader(strings.NewReader(data))
	records, err := reader.ReadAll()
	if err != nil {
		return nil, err
	}
	return records, nil
}

func CsvWithHeader(data string) ([]map[string]string, error) {
	reader := csv.NewReader(strings.NewReader(data))
	records, err := reader.ReadAll()
	if err != nil {
		return nil, err
	}
	if len(records) == 0 {
		return nil, errors.New("no data in CSV")
	}
	headers := records[0]
	result := make([]map[string]string, 0, (len(records) - 1))
	numRecords := len(records)
	i := 1
	for i < numRecords {
		row := records[i]
		rowMap := make(map[string]string)
		numHeaders := len(headers)
		numCols := len(row)
		maxCols := numHeaders
		if numCols < maxCols {
			maxCols = numCols
		}
		j := 0
		for j < maxCols {
			rowMap[headers[j]] = row[j]
			j = (j + 1)
		}
		result = append(result, rowMap)
		i = (i + 1)
	}
	return result, nil
}

func Yaml(data string) ([]byte, error) {
	return []byte(data), nil
}

func YamlPretty(value any) ([]byte, error) {
	yamlData, err := yaml.Marshal(value)
	if err != nil {
		return nil, err
	}
	return yamlData, nil
}
