// Generated by Kukicha v0.0.9 (requires Go 1.26+)

package parse_test

import (
	"fmt"
	"github.com/duber000/kukicha/stdlib/parse"
	kukistring "github.com/duber000/kukicha/stdlib/string"
	"testing"
)

//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:10
func TestJson(t *testing.T) {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:11
	payload := "{\"status\":\"ok\"}"
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:13
	result, err := parse.Json(payload)
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:14
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:15
		t.Fatalf("Json failed: %v", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:16
	if string(result) != payload {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:17
		t.Errorf("expected payload %v, got %v", payload, string(result))
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:20
func TestJsonLines(t *testing.T) {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:21
	ndjson := "{\"a\":1}\n\n {\"b\":2}\n"
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:23
	lines, err := parse.JsonLines(ndjson)
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:24
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:25
		t.Fatalf("JsonLines failed: %v", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:26
	if len(lines) != 2 {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:27
		t.Fatalf("expected 2 lines, got %v", len(lines))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:28
	if lines[0] != "{\"a\":1}" {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:29
		t.Errorf("expected first line to be trimmed")
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:32
func TestCsvWithHeader(t *testing.T) {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:33
	csv := "name,age\nalice,30\nbob,25"
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:35
	records, err := parse.Csv(csv)
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:36
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:37
		t.Fatalf("Csv failed: %v", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:38
	if len(records) != 3 {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:39
		t.Fatalf("expected 3 rows, got %v", len(records))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:41
	headerRows, err2 := parse.CsvWithHeader(csv)
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:42
	if err2 != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:43
		t.Fatalf("CsvWithHeader failed: %v", err2)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:44
	if len(headerRows) != 2 {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:45
		t.Fatalf("expected 2 data rows, got %v", len(headerRows))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:46
	if headerRows[0]["name"] != "alice" {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:47
		t.Errorf("expected first row to map name to alice")
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:50
func TestYamlPretty(t *testing.T) {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:51
	data := map[string]any{"user": map[string]any{"name": "sam"}}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:53
	pretty, err := parse.YamlPretty(data)
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:54
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:55
		t.Fatalf("YamlPretty failed: %v", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:56
	if kukistring.Contains(string(pretty), "user") == false {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:57
		t.Errorf("expected yaml preview to mention user")
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:60
func TestYaml(t *testing.T) {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:61
	payload := "user: alice\nemail: test@example.com"
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:63
	result, err := parse.Yaml(payload)
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:64
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:65
		t.Fatalf("Yaml failed: %v", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:66
	if string(result) != payload {
//line /var/home/tluker/repos/go/kukicha/stdlib/parse/parse_test.kuki:67
		t.Errorf("expected yaml payload to round trip")
	}
}
