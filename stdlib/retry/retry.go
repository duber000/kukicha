// Generated by Kukicha v0.0.3 (requires Go 1.26+)
//
// Performance: GOEXPERIMENT=jsonv2 enables faster JSON parsing (2-10x improvement)

package retry

import "time"

//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:15
type Config struct {
	MaxAttempts  int
	InitialDelay int
	Strategy     int
}

//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:21
func New() Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:22
	return Config{MaxAttempts: 3, InitialDelay: 1000, Strategy: 1}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:25
func Attempts(cfg Config, maxAttempts int) Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:26
	cfg.MaxAttempts = maxAttempts
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:27
	return cfg
}

//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:30
func Delay(cfg Config, delayMs int) Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:31
	cfg.InitialDelay = delayMs
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:32
	return cfg
}

//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:35
func Backoff(cfg Config, strategy int) Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:36
	cfg.Strategy = strategy
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:37
	return cfg
}

//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:41
func Sleep(cfg Config, attempt int) {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:42
	delay := calculateDelay(cfg, attempt)
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:43
	time.Sleep((time.Duration(delay) * time.Millisecond))
}

//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:46
func calculateDelay(cfg Config, attempt int) int {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:47
	if cfg.Strategy == 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:48
		return cfg.InitialDelay
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:51
	multiplier := 1
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:52
	i := 0
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:53
	for i < attempt {
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:54
		multiplier = (multiplier * 2)
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:55
		i = (i + 1)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/retry/retry.kuki:57
	return (cfg.InitialDelay * multiplier)
}
