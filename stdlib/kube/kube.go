// Generated by Kukicha v0.0.10 (requires Go 1.26+)

package kube

import (
	"errors"
	"fmt"
	"github.com/duber000/kukicha/stdlib/ctx"
	"github.com/duber000/kukicha/stdlib/retry"
	kukistring "github.com/duber000/kukicha/stdlib/string"
	"io"
	appsv1 "k8s.io/api/apps/v1"
	corev1 "k8s.io/api/core/v1"
	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
	"k8s.io/client-go/kubernetes"
	"k8s.io/client-go/rest"
	"k8s.io/client-go/tools/clientcmd"
	"os"
	"path/filepath"
	"time"
)

//line /home/user/kukicha/stdlib/kube/kube.kuki:38
type Cluster struct {
	client    any
	namespace string
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:43
type Config struct {
	kubeconfig       string
	context          string
	inCluster        bool
	retryMaxAttempts int
	retryDelayMs     int
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:51
type PodList struct {
	items any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:55
type Pod struct {
	pod any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:59
type DeploymentList struct {
	items any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:63
type Deployment struct {
	dep any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:67
type ServiceList struct {
	items any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:71
type Service struct {
	svc any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:75
type NodeList struct {
	items any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:79
type Node struct {
	node any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:83
type NamespaceList struct {
	items any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:87
type NamespaceItem struct {
	ns any
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:91
type PodEvent struct {
	eventType string
	name      string
	namespace string
	phase     string
	ready     bool
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:101
func New() Config {
//line /home/user/kukicha/stdlib/kube/kube.kuki:102
	return Config{}
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:105
func Kubeconfig(cfg Config, path string) Config {
//line /home/user/kukicha/stdlib/kube/kube.kuki:106
	cfg.kubeconfig = path
//line /home/user/kukicha/stdlib/kube/kube.kuki:107
	return cfg
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:110
func Context(cfg Config, name string) Config {
//line /home/user/kukicha/stdlib/kube/kube.kuki:111
	cfg.context = name
//line /home/user/kukicha/stdlib/kube/kube.kuki:112
	return cfg
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:115
func InCluster(cfg Config) Config {
//line /home/user/kukicha/stdlib/kube/kube.kuki:116
	cfg.inCluster = true
//line /home/user/kukicha/stdlib/kube/kube.kuki:117
	return cfg
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:122
func Retry(cfg Config, maxAttempts int, delayMs int) Config {
//line /home/user/kukicha/stdlib/kube/kube.kuki:123
	cfg.retryMaxAttempts = maxAttempts
//line /home/user/kukicha/stdlib/kube/kube.kuki:124
	cfg.retryDelayMs = delayMs
//line /home/user/kukicha/stdlib/kube/kube.kuki:125
	return cfg
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:128
func Namespace(c Cluster, ns string) Cluster {
//line /home/user/kukicha/stdlib/kube/kube.kuki:129
	c.namespace = ns
//line /home/user/kukicha/stdlib/kube/kube.kuki:130
	return c
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:135
func PodEventType(event PodEvent) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:136
	return event.eventType
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:139
func PodEventName(event PodEvent) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:140
	return event.name
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:143
func PodEventNamespace(event PodEvent) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:144
	return event.namespace
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:147
func PodEventPhase(event PodEvent) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:148
	return event.phase
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:151
func PodEventReady(event PodEvent) bool {
//line /home/user/kukicha/stdlib/kube/kube.kuki:152
	return event.ready
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:156
func clientset(c Cluster) *kubernetes.Clientset {
//line /home/user/kukicha/stdlib/kube/kube.kuki:157
	return c.client.(*kubernetes.Clientset)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:159
func pod(p Pod) *corev1.Pod {
//line /home/user/kukicha/stdlib/kube/kube.kuki:160
	return p.pod.(*corev1.Pod)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:162
func deployment(d Deployment) *appsv1.Deployment {
//line /home/user/kukicha/stdlib/kube/kube.kuki:163
	return d.dep.(*appsv1.Deployment)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:165
func service(s Service) *corev1.Service {
//line /home/user/kukicha/stdlib/kube/kube.kuki:166
	return s.svc.(*corev1.Service)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:168
func node(n Node) *corev1.Node {
//line /home/user/kukicha/stdlib/kube/kube.kuki:169
	return n.node.(*corev1.Node)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:171
func nsItem(n NamespaceItem) *corev1.Namespace {
//line /home/user/kukicha/stdlib/kube/kube.kuki:172
	return n.ns.(*corev1.Namespace)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:177
func Connect() (Cluster, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:178
	home, err := os.UserHomeDir()
//line /home/user/kukicha/stdlib/kube/kube.kuki:179
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:180
		return Cluster{}, fmt.Errorf("kube connect: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:181
	kubeconfig := filepath.Join(home, ".kube", "config")
//line /home/user/kukicha/stdlib/kube/kube.kuki:182
	config, cfgErr := clientcmd.BuildConfigFromFlags("", kubeconfig)
//line /home/user/kukicha/stdlib/kube/kube.kuki:183
	if cfgErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:184
		return Cluster{}, fmt.Errorf("kube connect: %w", cfgErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:185
	cs, csErr := kubernetes.NewForConfig(config)
//line /home/user/kukicha/stdlib/kube/kube.kuki:186
	if csErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:187
		return Cluster{}, fmt.Errorf("kube connect: %w", csErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:188
	return Cluster{client: cs, namespace: "default"}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:191
func openOnce(cfg Config) (Cluster, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:192
	if cfg.inCluster {
//line /home/user/kukicha/stdlib/kube/kube.kuki:193
		restConfig, err := rest.InClusterConfig()
//line /home/user/kukicha/stdlib/kube/kube.kuki:194
		if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:195
			return Cluster{}, fmt.Errorf("kube in-cluster: %w", err)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:196
		cs, csErr := kubernetes.NewForConfig(restConfig)
//line /home/user/kukicha/stdlib/kube/kube.kuki:197
		if csErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:198
			return Cluster{}, fmt.Errorf("kube open: %w", csErr)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:199
		return Cluster{client: cs, namespace: "default"}, nil
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:200
	kubeconfig := cfg.kubeconfig
//line /home/user/kukicha/stdlib/kube/kube.kuki:201
	if kubeconfig == "" {
//line /home/user/kukicha/stdlib/kube/kube.kuki:202
		home, homeErr := os.UserHomeDir()
//line /home/user/kukicha/stdlib/kube/kube.kuki:203
		if homeErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:204
			return Cluster{}, fmt.Errorf("kube config: %w", homeErr)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:205
		kubeconfig = filepath.Join(home, ".kube", "config")
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:206
	loadingRules := &clientcmd.ClientConfigLoadingRules{ExplicitPath: kubeconfig}
//line /home/user/kukicha/stdlib/kube/kube.kuki:207
	overrides := &clientcmd.ConfigOverrides{}
//line /home/user/kukicha/stdlib/kube/kube.kuki:208
	if cfg.context != "" {
//line /home/user/kukicha/stdlib/kube/kube.kuki:209
		overrides.CurrentContext = cfg.context
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:210
	restConfig, rcErr := clientcmd.NewNonInteractiveDeferredLoadingClientConfig(loadingRules, overrides).ClientConfig()
//line /home/user/kukicha/stdlib/kube/kube.kuki:211
	if rcErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:212
		return Cluster{}, fmt.Errorf("kube open: %w", rcErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:213
	cs, csErr := kubernetes.NewForConfig(restConfig)
//line /home/user/kukicha/stdlib/kube/kube.kuki:214
	if csErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:215
		return Cluster{}, fmt.Errorf("kube open: %w", csErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:216
	return Cluster{client: cs, namespace: "default"}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:220
func Open(cfg Config) (Cluster, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:221
	if cfg.retryMaxAttempts <= 1 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:222
		return openOnce(cfg)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:224
	delayMs := cfg.retryDelayMs
//line /home/user/kukicha/stdlib/kube/kube.kuki:225
	if delayMs <= 0 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:226
		delayMs = 1000
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:227
	retryCfg := retry.Config{MaxAttempts: cfg.retryMaxAttempts, InitialDelay: delayMs, Strategy: 1}
//line /home/user/kukicha/stdlib/kube/kube.kuki:228
	lastErr := errors.New("no attempts made")
//line /home/user/kukicha/stdlib/kube/kube.kuki:229
	for attempt := range retryCfg.MaxAttempts {
//line /home/user/kukicha/stdlib/kube/kube.kuki:230
		cluster, err := openOnce(cfg)
//line /home/user/kukicha/stdlib/kube/kube.kuki:231
		if err == nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:232
			return cluster, nil
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:233
		lastErr = err
//line /home/user/kukicha/stdlib/kube/kube.kuki:234
		retry.Sleep(retryCfg, attempt)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:235
	return Cluster{}, lastErr
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:240
func ListPods(c Cluster) (PodList, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:241
	pods, err := clientset(c).CoreV1().Pods(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:242
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:243
		return PodList{}, fmt.Errorf("kube list pods: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:244
	return PodList{items: pods}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:247
func ListPodsLabeled(c Cluster, selector string) (PodList, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:248
	pods, err := clientset(c).CoreV1().Pods(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{LabelSelector: selector})
//line /home/user/kukicha/stdlib/kube/kube.kuki:249
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:250
		return PodList{}, fmt.Errorf("kube list pods labeled: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:251
	return PodList{items: pods}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:254
func GetPod(c Cluster, name string) (Pod, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:255
	p, err := clientset(c).CoreV1().Pods(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:256
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:257
		return Pod{}, fmt.Errorf("kube get pod: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:258
	return Pod{pod: p}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:261
func DeletePod(c Cluster, name string) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:262
	err := clientset(c).CoreV1().Pods(c.namespace).Delete(ctx.Value(ctx.Background()), name, metav1.DeleteOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:263
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:264
		return fmt.Errorf("kube delete pod: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:265
	return nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:270
func ListDeployments(c Cluster) (DeploymentList, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:271
	deps, err := clientset(c).AppsV1().Deployments(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:272
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:273
		return DeploymentList{}, fmt.Errorf("kube list deployments: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:274
	return DeploymentList{items: deps}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:277
func GetDeployment(c Cluster, name string) (Deployment, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:278
	dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:279
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:280
		return Deployment{}, fmt.Errorf("kube get deployment: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:281
	return Deployment{dep: dep}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:284
func ScaleDeployment(c Cluster, name string, replicas int32) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:285
	scale, err := clientset(c).AppsV1().Deployments(c.namespace).GetScale(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:286
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:287
		return fmt.Errorf("kube scale get: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:288
	scale.Spec.Replicas = replicas
//line /home/user/kukicha/stdlib/kube/kube.kuki:289
	_, updateErr := clientset(c).AppsV1().Deployments(c.namespace).UpdateScale(ctx.Value(ctx.Background()), name, scale, metav1.UpdateOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:290
	if updateErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:291
		return fmt.Errorf("kube scale update: %w", updateErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:292
	return nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:295
func DeleteDeployment(c Cluster, name string) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:296
	err := clientset(c).AppsV1().Deployments(c.namespace).Delete(ctx.Value(ctx.Background()), name, metav1.DeleteOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:297
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:298
		return fmt.Errorf("kube delete deployment: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:299
	return nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:302
func RolloutRestart(c Cluster, name string) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:303
	dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:304
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:305
		return fmt.Errorf("kube rollout restart get: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:306
	if dep.Spec.Template.ObjectMeta.Annotations == nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:307
		dep.Spec.Template.ObjectMeta.Annotations = map[string]string{}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:308
	dep.Spec.Template.ObjectMeta.Annotations["kubectl.kubernetes.io/restartedAt"] = time.Now().UTC().Format(time.RFC3339)
//line /home/user/kukicha/stdlib/kube/kube.kuki:309
	_, updateErr := clientset(c).AppsV1().Deployments(c.namespace).Update(ctx.Value(ctx.Background()), dep, metav1.UpdateOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:310
	if updateErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:311
		return fmt.Errorf("kube rollout restart update: %w", updateErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:312
	return nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:318
func WaitDeploymentReady(c Cluster, name string, timeoutSeconds int64) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:319
	if timeoutSeconds <= 0 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:320
		timeoutSeconds = 300
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:321
	deadline := time.Now().Add((time.Duration(timeoutSeconds) * time.Second))
//line /home/user/kukicha/stdlib/kube/kube.kuki:322
	for {
//line /home/user/kukicha/stdlib/kube/kube.kuki:323
		dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:324
		if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:325
			return fmt.Errorf("kube wait deployment get: %w", err)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:326
		desired := int32(1)
//line /home/user/kukicha/stdlib/kube/kube.kuki:327
		if dep.Spec.Replicas != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:328
			desired = *dep.Spec.Replicas
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:329
		if ((dep.Status.ObservedGeneration >= dep.Generation) && (dep.Status.ReadyReplicas >= desired)) && (dep.Status.UpdatedReplicas >= desired) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:330
			return nil
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:331
		if time.Now().After(deadline) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:332
			return fmt.Errorf("kube wait deployment: timed out after %ds (ready=%d desired=%d updated=%d)", timeoutSeconds, dep.Status.ReadyReplicas, desired, dep.Status.UpdatedReplicas)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:333
		time.Sleep((2 * time.Second))
	}
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:337
func WaitPodReady(c Cluster, name string, timeoutSeconds int64) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:338
	if timeoutSeconds <= 0 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:339
		timeoutSeconds = 180
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:340
	deadline := time.Now().Add((time.Duration(timeoutSeconds) * time.Second))
//line /home/user/kukicha/stdlib/kube/kube.kuki:341
	for {
//line /home/user/kukicha/stdlib/kube/kube.kuki:342
		p, err := clientset(c).CoreV1().Pods(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:343
		if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:344
			return fmt.Errorf("kube wait pod get: %w", err)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:345
		ready := false
//line /home/user/kukicha/stdlib/kube/kube.kuki:346
		for _, cond := range p.Status.Conditions {
//line /home/user/kukicha/stdlib/kube/kube.kuki:347
			if cond.Type == corev1.PodReady {
//line /home/user/kukicha/stdlib/kube/kube.kuki:348
				ready = (cond.Status == corev1.ConditionTrue)
//line /home/user/kukicha/stdlib/kube/kube.kuki:349
				break
			}
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:350
		if ready {
//line /home/user/kukicha/stdlib/kube/kube.kuki:351
			return nil
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:352
		if time.Now().After(deadline) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:353
			return fmt.Errorf("kube wait pod: timed out after %ds", timeoutSeconds)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:354
		time.Sleep((1 * time.Second))
	}
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:357
func WaitDeploymentReadyCtx(c Cluster, h ctx.Handle, name string) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:358
	goCtx := ctx.Value(h)
//line /home/user/kukicha/stdlib/kube/kube.kuki:359
	for {
//line /home/user/kukicha/stdlib/kube/kube.kuki:360
		dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(goCtx, name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:361
		if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:362
			return fmt.Errorf("kube wait deployment get: %w", err)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:363
		desired := int32(1)
//line /home/user/kukicha/stdlib/kube/kube.kuki:364
		if dep.Spec.Replicas != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:365
			desired = *dep.Spec.Replicas
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:366
		if ((dep.Status.ObservedGeneration >= dep.Generation) && (dep.Status.ReadyReplicas >= desired)) && (dep.Status.UpdatedReplicas >= desired) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:367
			return nil
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:368
		ctxErr := goCtx.Err()
//line /home/user/kukicha/stdlib/kube/kube.kuki:369
		if ctxErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:370
			return fmt.Errorf("kube wait deployment: %w", ctxErr)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:371
		time.Sleep((2 * time.Second))
	}
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:374
func WaitPodReadyCtx(c Cluster, h ctx.Handle, name string) error {
//line /home/user/kukicha/stdlib/kube/kube.kuki:375
	goCtx := ctx.Value(h)
//line /home/user/kukicha/stdlib/kube/kube.kuki:376
	for {
//line /home/user/kukicha/stdlib/kube/kube.kuki:377
		p, err := clientset(c).CoreV1().Pods(c.namespace).Get(goCtx, name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:378
		if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:379
			return fmt.Errorf("kube wait pod get: %w", err)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:380
		ready := false
//line /home/user/kukicha/stdlib/kube/kube.kuki:381
		for _, cond := range p.Status.Conditions {
//line /home/user/kukicha/stdlib/kube/kube.kuki:382
			if cond.Type == corev1.PodReady {
//line /home/user/kukicha/stdlib/kube/kube.kuki:383
				ready = (cond.Status == corev1.ConditionTrue)
//line /home/user/kukicha/stdlib/kube/kube.kuki:384
				break
			}
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:385
		if ready {
//line /home/user/kukicha/stdlib/kube/kube.kuki:386
			return nil
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:387
		ctxErr := goCtx.Err()
//line /home/user/kukicha/stdlib/kube/kube.kuki:388
		if ctxErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:389
			return fmt.Errorf("kube wait pod: %w", ctxErr)
		}
//line /home/user/kukicha/stdlib/kube/kube.kuki:390
		time.Sleep((1 * time.Second))
	}
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:395
func ListServices(c Cluster) (ServiceList, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:396
	svcs, err := clientset(c).CoreV1().Services(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:397
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:398
		return ServiceList{}, fmt.Errorf("kube list services: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:399
	return ServiceList{items: svcs}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:402
func GetService(c Cluster, name string) (Service, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:403
	svc, err := clientset(c).CoreV1().Services(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:404
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:405
		return Service{}, fmt.Errorf("kube get service: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:406
	return Service{svc: svc}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:411
func ListNodes(c Cluster) (NodeList, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:412
	nodes, err := clientset(c).CoreV1().Nodes().List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:413
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:414
		return NodeList{}, fmt.Errorf("kube list nodes: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:415
	return NodeList{items: nodes}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:418
func GetNode(c Cluster, name string) (Node, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:419
	n, err := clientset(c).CoreV1().Nodes().Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:420
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:421
		return Node{}, fmt.Errorf("kube get node: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:422
	return Node{node: n}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:427
func ListNamespaces(c Cluster) (NamespaceList, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:428
	nsList, err := clientset(c).CoreV1().Namespaces().List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:429
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:430
		return NamespaceList{}, fmt.Errorf("kube list namespaces: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:431
	return NamespaceList{items: nsList}, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:436
func Pods(pl PodList) []Pod {
//line /home/user/kukicha/stdlib/kube/kube.kuki:437
	podList := pl.items.(*corev1.PodList)
//line /home/user/kukicha/stdlib/kube/kube.kuki:438
	result := make([]Pod, len(podList.Items))
//line /home/user/kukicha/stdlib/kube/kube.kuki:439
	for i := range len(podList.Items) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:440
		result[i] = Pod{pod: &podList.Items[i]}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:441
	return result
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:444
func Deployments(dl DeploymentList) []Deployment {
//line /home/user/kukicha/stdlib/kube/kube.kuki:445
	depList := dl.items.(*appsv1.DeploymentList)
//line /home/user/kukicha/stdlib/kube/kube.kuki:446
	result := make([]Deployment, len(depList.Items))
//line /home/user/kukicha/stdlib/kube/kube.kuki:447
	for i := range len(depList.Items) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:448
		result[i] = Deployment{dep: &depList.Items[i]}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:449
	return result
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:452
func Services(sl ServiceList) []Service {
//line /home/user/kukicha/stdlib/kube/kube.kuki:453
	svcList := sl.items.(*corev1.ServiceList)
//line /home/user/kukicha/stdlib/kube/kube.kuki:454
	result := make([]Service, len(svcList.Items))
//line /home/user/kukicha/stdlib/kube/kube.kuki:455
	for i := range len(svcList.Items) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:456
		result[i] = Service{svc: &svcList.Items[i]}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:457
	return result
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:460
func Nodes(nl NodeList) []Node {
//line /home/user/kukicha/stdlib/kube/kube.kuki:461
	nodeList := nl.items.(*corev1.NodeList)
//line /home/user/kukicha/stdlib/kube/kube.kuki:462
	result := make([]Node, len(nodeList.Items))
//line /home/user/kukicha/stdlib/kube/kube.kuki:463
	for i := range len(nodeList.Items) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:464
		result[i] = Node{node: &nodeList.Items[i]}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:465
	return result
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:468
func Namespaces(nsl NamespaceList) []NamespaceItem {
//line /home/user/kukicha/stdlib/kube/kube.kuki:469
	nsList := nsl.items.(*corev1.NamespaceList)
//line /home/user/kukicha/stdlib/kube/kube.kuki:470
	result := make([]NamespaceItem, len(nsList.Items))
//line /home/user/kukicha/stdlib/kube/kube.kuki:471
	for i := range len(nsList.Items) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:472
		result[i] = NamespaceItem{ns: &nsList.Items[i]}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:473
	return result
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:478
func PodName(p Pod) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:479
	return pod(p).Name
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:482
func PodStatus(p Pod) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:483
	return string(pod(p).Status.Phase)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:486
func PodIP(p Pod) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:487
	return pod(p).Status.PodIP
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:490
func PodNode(p Pod) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:491
	return pod(p).Spec.NodeName
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:494
func PodAge(p Pod) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:495
	d := time.Since(pod(p).CreationTimestamp.Time)
//line /home/user/kukicha/stdlib/kube/kube.kuki:496
	if d.Hours() >= 24 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:497
		days := (d.Hours() / 24)
//line /home/user/kukicha/stdlib/kube/kube.kuki:498
		return fmt.Sprintf("%dd", int(days))
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:499
	if d.Hours() >= 1 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:500
		return fmt.Sprintf("%dh", int(d.Hours()))
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:501
	return fmt.Sprintf("%dm", int(d.Minutes()))
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:504
func PodReady(p Pod) bool {
//line /home/user/kukicha/stdlib/kube/kube.kuki:505
	for _, cond := range pod(p).Status.Conditions {
//line /home/user/kukicha/stdlib/kube/kube.kuki:506
		if cond.Type == corev1.PodReady {
//line /home/user/kukicha/stdlib/kube/kube.kuki:507
			return (cond.Status == corev1.ConditionTrue)
		}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:508
	return false
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:511
func PodRestarts(p Pod) int32 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:512
	total := int32(0)
//line /home/user/kukicha/stdlib/kube/kube.kuki:513
	for _, cs := range pod(p).Status.ContainerStatuses {
//line /home/user/kukicha/stdlib/kube/kube.kuki:514
		total = (total + cs.RestartCount)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:515
	return total
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:518
func PodLabels(p Pod) map[string]string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:519
	return pod(p).Labels
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:524
func DeploymentName(d Deployment) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:525
	return deployment(d).Name
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:528
func DeploymentReplicas(d Deployment) int32 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:529
	if deployment(d).Spec.Replicas != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:530
		return *deployment(d).Spec.Replicas
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:531
	return 1
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:534
func DeploymentReady(d Deployment) int32 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:535
	return deployment(d).Status.ReadyReplicas
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:538
func DeploymentImage(d Deployment) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:539
	containers := deployment(d).Spec.Template.Spec.Containers
//line /home/user/kukicha/stdlib/kube/kube.kuki:540
	if len(containers) > 0 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:541
		return containers[0].Image
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:542
	return ""
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:547
func ServiceName(s Service) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:548
	return service(s).Name
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:551
func ServiceType(s Service) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:552
	return string(service(s).Spec.Type)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:555
func ServiceClusterIP(s Service) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:556
	return service(s).Spec.ClusterIP
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:559
func ServicePorts(s Service) []string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:560
	ports := service(s).Spec.Ports
//line /home/user/kukicha/stdlib/kube/kube.kuki:561
	result := make([]string, len(ports))
//line /home/user/kukicha/stdlib/kube/kube.kuki:562
	for i, p := range ports {
//line /home/user/kukicha/stdlib/kube/kube.kuki:563
		result[i] = fmt.Sprintf("%d/%s", p.Port, p.Protocol)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:564
	return result
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:569
func NodeName(n Node) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:570
	return node(n).Name
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:573
func NodeReady(n Node) bool {
//line /home/user/kukicha/stdlib/kube/kube.kuki:574
	for _, cond := range node(n).Status.Conditions {
//line /home/user/kukicha/stdlib/kube/kube.kuki:575
		if cond.Type == corev1.NodeReady {
//line /home/user/kukicha/stdlib/kube/kube.kuki:576
			return (cond.Status == corev1.ConditionTrue)
		}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:577
	return false
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:580
func NodeRoles(n Node) []string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:581
	roles := make([]string, 0)
//line /home/user/kukicha/stdlib/kube/kube.kuki:582
	for label := range node(n).Labels {
//line /home/user/kukicha/stdlib/kube/kube.kuki:583
		prefix := "node-role.kubernetes.io/"
//line /home/user/kukicha/stdlib/kube/kube.kuki:584
		if kukistring.HasPrefix(label, prefix) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:585
			role := kukistring.TrimPrefix(label, prefix)
//line /home/user/kukicha/stdlib/kube/kube.kuki:586
			if role != "" {
//line /home/user/kukicha/stdlib/kube/kube.kuki:587
				roles = append(roles, role)
			}
		}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:588
	if len(roles) == 0 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:589
		roles = append(roles, "<none>")
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:590
	return roles
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:593
func NodeVersion(n Node) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:594
	return node(n).Status.NodeInfo.KubeletVersion
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:599
func NamespaceName(n NamespaceItem) string {
//line /home/user/kukicha/stdlib/kube/kube.kuki:600
	return nsItem(n).Name
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:605
func watchPodsWithContext(h ctx.Handle, c Cluster) ([]PodEvent, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:606
	goCtx := ctx.Value(h)
//line /home/user/kukicha/stdlib/kube/kube.kuki:607
	watcher, err := clientset(c).CoreV1().Pods(c.namespace).Watch(goCtx, metav1.ListOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:608
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:609
		return nil, fmt.Errorf("kube watch pods: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:610
	defer watcher.Stop()
//line /home/user/kukicha/stdlib/kube/kube.kuki:611
	events := make([]PodEvent, 0)
//line /home/user/kukicha/stdlib/kube/kube.kuki:612
	for {
//line /home/user/kukicha/stdlib/kube/kube.kuki:613
		select {
		case <-goCtx.Done():
//line /home/user/kukicha/stdlib/kube/kube.kuki:615
			return events, nil
		case event, ok := <-watcher.ResultChan():
//line /home/user/kukicha/stdlib/kube/kube.kuki:617
			if !ok {
//line /home/user/kukicha/stdlib/kube/kube.kuki:618
				return events, nil
			}
//line /home/user/kukicha/stdlib/kube/kube.kuki:619
			p, podOk := event.Object.(*corev1.Pod)
//line /home/user/kukicha/stdlib/kube/kube.kuki:620
			if !podOk {
//line /home/user/kukicha/stdlib/kube/kube.kuki:621
				continue
			}
//line /home/user/kukicha/stdlib/kube/kube.kuki:622
			ready := false
//line /home/user/kukicha/stdlib/kube/kube.kuki:623
			for _, cond := range p.Status.Conditions {
//line /home/user/kukicha/stdlib/kube/kube.kuki:624
				if cond.Type == corev1.PodReady {
//line /home/user/kukicha/stdlib/kube/kube.kuki:625
					ready = (cond.Status == corev1.ConditionTrue)
//line /home/user/kukicha/stdlib/kube/kube.kuki:626
					break
				}
			}
//line /home/user/kukicha/stdlib/kube/kube.kuki:633
			events = append(events, PodEvent{eventType: string(event.Type), name: p.Name, namespace: p.Namespace, phase: string(p.Status.Phase), ready: ready})
		}
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:634
	return events, nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:638
func WatchPods(c Cluster, timeoutSeconds int64) ([]PodEvent, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:639
	if timeoutSeconds <= 0 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:640
		timeoutSeconds = 30
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:641
	h := ctx.WithTimeout(ctx.Background(), timeoutSeconds)
//line /home/user/kukicha/stdlib/kube/kube.kuki:642
	defer ctx.Cancel(h)
//line /home/user/kukicha/stdlib/kube/kube.kuki:643
	return watchPodsWithContext(h, c)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:646
func WatchPodsCtx(c Cluster, h ctx.Handle) ([]PodEvent, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:647
	return watchPodsWithContext(h, c)
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:653
func PodLogs(c Cluster, name string, handles ...ctx.Handle) (string, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:654
	goCtx := ctx.Value(ctx.Background())
//line /home/user/kukicha/stdlib/kube/kube.kuki:655
	if len(handles) > 0 {
//line /home/user/kukicha/stdlib/kube/kube.kuki:656
		goCtx = ctx.Value(handles[0])
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:657
	req := clientset(c).CoreV1().Pods(c.namespace).GetLogs(name, &corev1.PodLogOptions{})
//line /home/user/kukicha/stdlib/kube/kube.kuki:658
	stream, err := req.Stream(goCtx)
//line /home/user/kukicha/stdlib/kube/kube.kuki:659
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:660
		return "", fmt.Errorf("kube pod logs: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:661
	defer stream.Close()
//line /home/user/kukicha/stdlib/kube/kube.kuki:662
	data, readErr := io.ReadAll(stream)
//line /home/user/kukicha/stdlib/kube/kube.kuki:663
	if readErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:664
		return "", fmt.Errorf("kube pod logs read: %w", readErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:665
	return string(data), nil
}

//line /home/user/kukicha/stdlib/kube/kube.kuki:668
func PodLogsTail(c Cluster, name string, lines int64) (string, error) {
//line /home/user/kukicha/stdlib/kube/kube.kuki:669
	req := clientset(c).CoreV1().Pods(c.namespace).GetLogs(name, &corev1.PodLogOptions{TailLines: &lines})
//line /home/user/kukicha/stdlib/kube/kube.kuki:670
	stream, err := req.Stream(ctx.Value(ctx.Background()))
//line /home/user/kukicha/stdlib/kube/kube.kuki:671
	if err != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:672
		return "", fmt.Errorf("kube pod logs tail: %w", err)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:673
	defer stream.Close()
//line /home/user/kukicha/stdlib/kube/kube.kuki:674
	data, readErr := io.ReadAll(stream)
//line /home/user/kukicha/stdlib/kube/kube.kuki:675
	if readErr != nil {
//line /home/user/kukicha/stdlib/kube/kube.kuki:676
		return "", fmt.Errorf("kube pod logs tail read: %w", readErr)
	}
//line /home/user/kukicha/stdlib/kube/kube.kuki:677
	return string(data), nil
}
