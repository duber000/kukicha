// Generated by Kukicha v0.0.10 (requires Go 1.26+)

package kube

import (
	"errors"
	"fmt"
	"github.com/duber000/kukicha/stdlib/ctx"
	"github.com/duber000/kukicha/stdlib/retry"
	kukistring "github.com/duber000/kukicha/stdlib/string"
	"io"
	appsv1 "k8s.io/api/apps/v1"
	corev1 "k8s.io/api/core/v1"
	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
	"k8s.io/client-go/kubernetes"
	"k8s.io/client-go/rest"
	"k8s.io/client-go/tools/clientcmd"
	"os"
	"path/filepath"
	"time"
)

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:38
type Cluster struct {
	client    any
	namespace string
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:43
type Config struct {
	kubeconfig       string
	context          string
	inCluster        bool
	retryMaxAttempts int
	retryDelayMs     int
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:51
type PodList struct {
	items any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:55
type Pod struct {
	pod any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:59
type DeploymentList struct {
	items any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:63
type Deployment struct {
	dep any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:67
type ServiceList struct {
	items any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:71
type Service struct {
	svc any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:75
type NodeList struct {
	items any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:79
type Node struct {
	node any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:83
type NamespaceList struct {
	items any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:87
type NamespaceItem struct {
	ns any
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:91
type PodEvent struct {
	eventType string
	name      string
	namespace string
	phase     string
	ready     bool
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:101
func New() Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:102
	return Config{}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:105
func Kubeconfig(cfg Config, path string) Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:106
	cfg.kubeconfig = path
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:107
	return cfg
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:110
func Context(cfg Config, name string) Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:111
	cfg.context = name
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:112
	return cfg
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:115
func InCluster(cfg Config) Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:116
	cfg.inCluster = true
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:117
	return cfg
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:122
func Retry(cfg Config, maxAttempts int, delayMs int) Config {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:123
	cfg.retryMaxAttempts = maxAttempts
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:124
	cfg.retryDelayMs = delayMs
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:125
	return cfg
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:128
func Namespace(c Cluster, ns string) Cluster {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:129
	c.namespace = ns
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:130
	return c
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:135
func PodEventType(event PodEvent) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:136
	return event.eventType
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:139
func PodEventName(event PodEvent) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:140
	return event.name
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:143
func PodEventNamespace(event PodEvent) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:144
	return event.namespace
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:147
func PodEventPhase(event PodEvent) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:148
	return event.phase
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:151
func PodEventReady(event PodEvent) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:152
	return event.ready
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:156
func clientset(c Cluster) *kubernetes.Clientset {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:157
	return c.client.(*kubernetes.Clientset)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:159
func pod(p Pod) *corev1.Pod {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:160
	return p.pod.(*corev1.Pod)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:162
func deployment(d Deployment) *appsv1.Deployment {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:163
	return d.dep.(*appsv1.Deployment)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:165
func service(s Service) *corev1.Service {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:166
	return s.svc.(*corev1.Service)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:168
func node(n Node) *corev1.Node {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:169
	return n.node.(*corev1.Node)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:171
func nsItem(n NamespaceItem) *corev1.Namespace {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:172
	return n.ns.(*corev1.Namespace)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:177
func Connect() (Cluster, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:178
	home, err := os.UserHomeDir()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:179
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:180
		return Cluster{}, fmt.Errorf("kube connect: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:181
	kubeconfig := filepath.Join(home, ".kube", "config")
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:182
	config, cfgErr := clientcmd.BuildConfigFromFlags("", kubeconfig)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:183
	if cfgErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:184
		return Cluster{}, fmt.Errorf("kube connect: %w", cfgErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:185
	cs, csErr := kubernetes.NewForConfig(config)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:186
	if csErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:187
		return Cluster{}, fmt.Errorf("kube connect: %w", csErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:188
	return Cluster{client: cs, namespace: "default"}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:191
func openOnce(cfg Config) (Cluster, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:192
	if cfg.inCluster {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:193
		restConfig, err := rest.InClusterConfig()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:194
		if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:195
			return Cluster{}, fmt.Errorf("kube in-cluster: %w", err)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:196
		cs, csErr := kubernetes.NewForConfig(restConfig)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:197
		if csErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:198
			return Cluster{}, fmt.Errorf("kube open: %w", csErr)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:199
		return Cluster{client: cs, namespace: "default"}, nil
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:200
	kubeconfig := cfg.kubeconfig
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:201
	if kubeconfig == "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:202
		home, homeErr := os.UserHomeDir()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:203
		if homeErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:204
			return Cluster{}, fmt.Errorf("kube config: %w", homeErr)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:205
		kubeconfig = filepath.Join(home, ".kube", "config")
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:206
	loadingRules := &clientcmd.ClientConfigLoadingRules{ExplicitPath: kubeconfig}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:207
	overrides := &clientcmd.ConfigOverrides{}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:208
	if cfg.context != "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:209
		overrides.CurrentContext = cfg.context
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:210
	restConfig, rcErr := clientcmd.NewNonInteractiveDeferredLoadingClientConfig(loadingRules, overrides).ClientConfig()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:211
	if rcErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:212
		return Cluster{}, fmt.Errorf("kube open: %w", rcErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:213
	cs, csErr := kubernetes.NewForConfig(restConfig)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:214
	if csErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:215
		return Cluster{}, fmt.Errorf("kube open: %w", csErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:216
	return Cluster{client: cs, namespace: "default"}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:220
func Open(cfg Config) (Cluster, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:221
	if cfg.retryMaxAttempts <= 1 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:222
		return openOnce(cfg)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:224
	delayMs := cfg.retryDelayMs
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:225
	if delayMs <= 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:226
		delayMs = 1000
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:227
	retryCfg := retry.Config{MaxAttempts: cfg.retryMaxAttempts, InitialDelay: delayMs, Strategy: 1}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:228
	attempt := 0
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:229
	lastErr := errors.New("no attempts made")
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:230
	for attempt < retryCfg.MaxAttempts {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:231
		cluster, err := openOnce(cfg)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:232
		if err == nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:233
			return cluster, nil
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:234
		lastErr = err
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:235
		retry.Sleep(retryCfg, attempt)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:236
		attempt = (attempt + 1)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:237
	return Cluster{}, lastErr
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:242
func ListPods(c Cluster) (PodList, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:243
	pods, err := clientset(c).CoreV1().Pods(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:244
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:245
		return PodList{}, fmt.Errorf("kube list pods: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:246
	return PodList{items: pods}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:249
func ListPodsLabeled(c Cluster, selector string) (PodList, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:250
	pods, err := clientset(c).CoreV1().Pods(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{LabelSelector: selector})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:251
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:252
		return PodList{}, fmt.Errorf("kube list pods labeled: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:253
	return PodList{items: pods}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:256
func GetPod(c Cluster, name string) (Pod, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:257
	p, err := clientset(c).CoreV1().Pods(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:258
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:259
		return Pod{}, fmt.Errorf("kube get pod: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:260
	return Pod{pod: p}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:263
func DeletePod(c Cluster, name string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:264
	err := clientset(c).CoreV1().Pods(c.namespace).Delete(ctx.Value(ctx.Background()), name, metav1.DeleteOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:265
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:266
		return fmt.Errorf("kube delete pod: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:267
	return nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:272
func ListDeployments(c Cluster) (DeploymentList, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:273
	deps, err := clientset(c).AppsV1().Deployments(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:274
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:275
		return DeploymentList{}, fmt.Errorf("kube list deployments: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:276
	return DeploymentList{items: deps}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:279
func GetDeployment(c Cluster, name string) (Deployment, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:280
	dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:281
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:282
		return Deployment{}, fmt.Errorf("kube get deployment: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:283
	return Deployment{dep: dep}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:286
func ScaleDeployment(c Cluster, name string, replicas int32) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:287
	scale, err := clientset(c).AppsV1().Deployments(c.namespace).GetScale(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:288
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:289
		return fmt.Errorf("kube scale get: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:290
	scale.Spec.Replicas = replicas
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:291
	_, updateErr := clientset(c).AppsV1().Deployments(c.namespace).UpdateScale(ctx.Value(ctx.Background()), name, scale, metav1.UpdateOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:292
	if updateErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:293
		return fmt.Errorf("kube scale update: %w", updateErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:294
	return nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:297
func DeleteDeployment(c Cluster, name string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:298
	err := clientset(c).AppsV1().Deployments(c.namespace).Delete(ctx.Value(ctx.Background()), name, metav1.DeleteOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:299
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:300
		return fmt.Errorf("kube delete deployment: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:301
	return nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:304
func RolloutRestart(c Cluster, name string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:305
	dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:306
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:307
		return fmt.Errorf("kube rollout restart get: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:308
	if dep.Spec.Template.ObjectMeta.Annotations == nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:309
		dep.Spec.Template.ObjectMeta.Annotations = map[string]string{}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:310
	dep.Spec.Template.ObjectMeta.Annotations["kubectl.kubernetes.io/restartedAt"] = time.Now().UTC().Format(time.RFC3339)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:311
	_, updateErr := clientset(c).AppsV1().Deployments(c.namespace).Update(ctx.Value(ctx.Background()), dep, metav1.UpdateOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:312
	if updateErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:313
		return fmt.Errorf("kube rollout restart update: %w", updateErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:314
	return nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:320
func WaitDeploymentReady(c Cluster, name string, timeoutSeconds int64) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:321
	if timeoutSeconds <= 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:322
		timeoutSeconds = 300
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:323
	deadline := time.Now().Add((time.Duration(timeoutSeconds) * time.Second))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:324
	for {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:325
		dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:326
		if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:327
			return fmt.Errorf("kube wait deployment get: %w", err)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:328
		desired := int32(1)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:329
		if dep.Spec.Replicas != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:330
			desired = *dep.Spec.Replicas
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:331
		if ((dep.Status.ObservedGeneration >= dep.Generation) && (dep.Status.ReadyReplicas >= desired)) && (dep.Status.UpdatedReplicas >= desired) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:332
			return nil
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:333
		if time.Now().After(deadline) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:334
			return fmt.Errorf("kube wait deployment: timed out after %ds (ready=%d desired=%d updated=%d)", timeoutSeconds, dep.Status.ReadyReplicas, desired, dep.Status.UpdatedReplicas)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:335
		time.Sleep((2 * time.Second))
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:339
func WaitPodReady(c Cluster, name string, timeoutSeconds int64) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:340
	if timeoutSeconds <= 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:341
		timeoutSeconds = 180
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:342
	deadline := time.Now().Add((time.Duration(timeoutSeconds) * time.Second))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:343
	for {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:344
		p, err := clientset(c).CoreV1().Pods(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:345
		if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:346
			return fmt.Errorf("kube wait pod get: %w", err)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:347
		ready := false
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:348
		for _, cond := range p.Status.Conditions {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:349
			if cond.Type == corev1.PodReady {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:350
				ready = (cond.Status == corev1.ConditionTrue)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:351
				break
			}
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:352
		if ready {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:353
			return nil
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:354
		if time.Now().After(deadline) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:355
			return fmt.Errorf("kube wait pod: timed out after %ds", timeoutSeconds)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:356
		time.Sleep((1 * time.Second))
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:359
func WaitDeploymentReadyCtx(c Cluster, h ctx.Handle, name string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:360
	goCtx := ctx.Value(h)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:361
	for {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:362
		dep, err := clientset(c).AppsV1().Deployments(c.namespace).Get(goCtx, name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:363
		if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:364
			return fmt.Errorf("kube wait deployment get: %w", err)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:365
		desired := int32(1)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:366
		if dep.Spec.Replicas != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:367
			desired = *dep.Spec.Replicas
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:368
		if ((dep.Status.ObservedGeneration >= dep.Generation) && (dep.Status.ReadyReplicas >= desired)) && (dep.Status.UpdatedReplicas >= desired) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:369
			return nil
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:370
		ctxErr := goCtx.Err()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:371
		if ctxErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:372
			return fmt.Errorf("kube wait deployment: %w", ctxErr)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:373
		time.Sleep((2 * time.Second))
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:376
func WaitPodReadyCtx(c Cluster, h ctx.Handle, name string) error {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:377
	goCtx := ctx.Value(h)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:378
	for {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:379
		p, err := clientset(c).CoreV1().Pods(c.namespace).Get(goCtx, name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:380
		if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:381
			return fmt.Errorf("kube wait pod get: %w", err)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:382
		ready := false
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:383
		for _, cond := range p.Status.Conditions {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:384
			if cond.Type == corev1.PodReady {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:385
				ready = (cond.Status == corev1.ConditionTrue)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:386
				break
			}
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:387
		if ready {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:388
			return nil
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:389
		ctxErr := goCtx.Err()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:390
		if ctxErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:391
			return fmt.Errorf("kube wait pod: %w", ctxErr)
		}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:392
		time.Sleep((1 * time.Second))
	}
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:397
func ListServices(c Cluster) (ServiceList, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:398
	svcs, err := clientset(c).CoreV1().Services(c.namespace).List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:399
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:400
		return ServiceList{}, fmt.Errorf("kube list services: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:401
	return ServiceList{items: svcs}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:404
func GetService(c Cluster, name string) (Service, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:405
	svc, err := clientset(c).CoreV1().Services(c.namespace).Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:406
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:407
		return Service{}, fmt.Errorf("kube get service: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:408
	return Service{svc: svc}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:413
func ListNodes(c Cluster) (NodeList, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:414
	nodes, err := clientset(c).CoreV1().Nodes().List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:415
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:416
		return NodeList{}, fmt.Errorf("kube list nodes: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:417
	return NodeList{items: nodes}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:420
func GetNode(c Cluster, name string) (Node, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:421
	n, err := clientset(c).CoreV1().Nodes().Get(ctx.Value(ctx.Background()), name, metav1.GetOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:422
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:423
		return Node{}, fmt.Errorf("kube get node: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:424
	return Node{node: n}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:429
func ListNamespaces(c Cluster) (NamespaceList, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:430
	nsList, err := clientset(c).CoreV1().Namespaces().List(ctx.Value(ctx.Background()), metav1.ListOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:431
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:432
		return NamespaceList{}, fmt.Errorf("kube list namespaces: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:433
	return NamespaceList{items: nsList}, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:438
func Pods(pl PodList) []Pod {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:439
	podList := pl.items.(*corev1.PodList)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:440
	result := make([]Pod, len(podList.Items))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:441
	for i := range len(podList.Items) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:442
		result[i] = Pod{pod: &podList.Items[i]}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:443
	return result
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:446
func Deployments(dl DeploymentList) []Deployment {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:447
	depList := dl.items.(*appsv1.DeploymentList)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:448
	result := make([]Deployment, len(depList.Items))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:449
	for i := range len(depList.Items) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:450
		result[i] = Deployment{dep: &depList.Items[i]}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:451
	return result
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:454
func Services(sl ServiceList) []Service {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:455
	svcList := sl.items.(*corev1.ServiceList)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:456
	result := make([]Service, len(svcList.Items))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:457
	for i := range len(svcList.Items) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:458
		result[i] = Service{svc: &svcList.Items[i]}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:459
	return result
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:462
func Nodes(nl NodeList) []Node {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:463
	nodeList := nl.items.(*corev1.NodeList)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:464
	result := make([]Node, len(nodeList.Items))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:465
	for i := range len(nodeList.Items) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:466
		result[i] = Node{node: &nodeList.Items[i]}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:467
	return result
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:470
func Namespaces(nsl NamespaceList) []NamespaceItem {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:471
	nsList := nsl.items.(*corev1.NamespaceList)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:472
	result := make([]NamespaceItem, len(nsList.Items))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:473
	for i := range len(nsList.Items) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:474
		result[i] = NamespaceItem{ns: &nsList.Items[i]}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:475
	return result
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:480
func PodName(p Pod) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:481
	return pod(p).Name
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:484
func PodStatus(p Pod) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:485
	return string(pod(p).Status.Phase)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:488
func PodIP(p Pod) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:489
	return pod(p).Status.PodIP
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:492
func PodNode(p Pod) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:493
	return pod(p).Spec.NodeName
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:496
func PodAge(p Pod) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:497
	d := time.Since(pod(p).CreationTimestamp.Time)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:498
	if d.Hours() >= 24 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:499
		days := (d.Hours() / 24)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:500
		return fmt.Sprintf("%dd", int(days))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:501
	if d.Hours() >= 1 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:502
		return fmt.Sprintf("%dh", int(d.Hours()))
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:503
	return fmt.Sprintf("%dm", int(d.Minutes()))
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:506
func PodReady(p Pod) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:507
	for _, cond := range pod(p).Status.Conditions {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:508
		if cond.Type == corev1.PodReady {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:509
			return (cond.Status == corev1.ConditionTrue)
		}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:510
	return false
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:513
func PodRestarts(p Pod) int32 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:514
	total := int32(0)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:515
	for _, cs := range pod(p).Status.ContainerStatuses {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:516
		total = (total + cs.RestartCount)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:517
	return total
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:520
func PodLabels(p Pod) map[string]string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:521
	return pod(p).Labels
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:526
func DeploymentName(d Deployment) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:527
	return deployment(d).Name
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:530
func DeploymentReplicas(d Deployment) int32 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:531
	if deployment(d).Spec.Replicas != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:532
		return *deployment(d).Spec.Replicas
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:533
	return 1
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:536
func DeploymentReady(d Deployment) int32 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:537
	return deployment(d).Status.ReadyReplicas
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:540
func DeploymentImage(d Deployment) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:541
	containers := deployment(d).Spec.Template.Spec.Containers
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:542
	if len(containers) > 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:543
		return containers[0].Image
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:544
	return ""
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:549
func ServiceName(s Service) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:550
	return service(s).Name
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:553
func ServiceType(s Service) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:554
	return string(service(s).Spec.Type)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:557
func ServiceClusterIP(s Service) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:558
	return service(s).Spec.ClusterIP
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:561
func ServicePorts(s Service) []string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:562
	ports := service(s).Spec.Ports
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:563
	result := make([]string, len(ports))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:564
	for i, p := range ports {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:565
		result[i] = fmt.Sprintf("%d/%s", p.Port, p.Protocol)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:566
	return result
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:571
func NodeName(n Node) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:572
	return node(n).Name
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:575
func NodeReady(n Node) bool {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:576
	for _, cond := range node(n).Status.Conditions {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:577
		if cond.Type == corev1.NodeReady {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:578
			return (cond.Status == corev1.ConditionTrue)
		}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:579
	return false
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:582
func NodeRoles(n Node) []string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:583
	roles := make([]string, 0)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:584
	for label, _ := range node(n).Labels {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:585
		prefix := "node-role.kubernetes.io/"
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:586
		if kukistring.HasPrefix(label, prefix) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:587
			role := kukistring.TrimPrefix(label, prefix)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:588
			if role != "" {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:589
				roles = append(roles, role)
			}
		}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:590
	if len(roles) == 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:591
		roles = append(roles, "<none>")
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:592
	return roles
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:595
func NodeVersion(n Node) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:596
	return node(n).Status.NodeInfo.KubeletVersion
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:601
func NamespaceName(n NamespaceItem) string {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:602
	return nsItem(n).Name
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:607
func watchPodsWithContext(h ctx.Handle, c Cluster) ([]PodEvent, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:608
	goCtx := ctx.Value(h)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:609
	watcher, err := clientset(c).CoreV1().Pods(c.namespace).Watch(goCtx, metav1.ListOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:610
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:611
		return nil, fmt.Errorf("kube watch pods: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:612
	defer watcher.Stop()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:613
	events := make([]PodEvent, 0)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:614
	for {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:615
		select {
		case <-goCtx.Done():
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:617
			return events, nil
		case event, ok := <-watcher.ResultChan():
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:619
			if !ok {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:620
				return events, nil
			}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:621
			p, podOk := event.Object.(*corev1.Pod)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:622
			if !podOk {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:623
				continue
			}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:624
			ready := false
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:625
			for _, cond := range p.Status.Conditions {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:626
				if cond.Type == corev1.PodReady {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:627
					ready = (cond.Status == corev1.ConditionTrue)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:628
					break
				}
			}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:635
			events = append(events, PodEvent{eventType: string(event.Type), name: p.Name, namespace: p.Namespace, phase: string(p.Status.Phase), ready: ready})
		}
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:636
	return events, nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:640
func WatchPods(c Cluster, timeoutSeconds int64) ([]PodEvent, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:641
	if timeoutSeconds <= 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:642
		timeoutSeconds = 30
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:643
	h := ctx.WithTimeout(ctx.Background(), timeoutSeconds)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:644
	defer ctx.Cancel(h)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:645
	return watchPodsWithContext(h, c)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:648
func WatchPodsCtx(c Cluster, h ctx.Handle) ([]PodEvent, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:649
	return watchPodsWithContext(h, c)
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:655
func PodLogs(c Cluster, name string, handles ...ctx.Handle) (string, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:656
	goCtx := ctx.Value(ctx.Background())
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:657
	if len(handles) > 0 {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:658
		goCtx = ctx.Value(handles[0])
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:659
	req := clientset(c).CoreV1().Pods(c.namespace).GetLogs(name, &corev1.PodLogOptions{})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:660
	stream, err := req.Stream(goCtx)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:661
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:662
		return "", fmt.Errorf("kube pod logs: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:663
	defer stream.Close()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:664
	data, readErr := io.ReadAll(stream)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:665
	if readErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:666
		return "", fmt.Errorf("kube pod logs read: %w", readErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:667
	return string(data), nil
}

//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:670
func PodLogsTail(c Cluster, name string, lines int64) (string, error) {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:671
	req := clientset(c).CoreV1().Pods(c.namespace).GetLogs(name, &corev1.PodLogOptions{TailLines: &lines})
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:672
	stream, err := req.Stream(ctx.Value(ctx.Background()))
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:673
	if err != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:674
		return "", fmt.Errorf("kube pod logs tail: %w", err)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:675
	defer stream.Close()
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:676
	data, readErr := io.ReadAll(stream)
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:677
	if readErr != nil {
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:678
		return "", fmt.Errorf("kube pod logs tail read: %w", readErr)
	}
//line /var/home/tluker/repos/go/kukicha/stdlib/kube/kube.kuki:679
	return string(data), nil
}
