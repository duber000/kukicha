# Tests for Kukicha Standard Library - Template Package

petiole template_test

import "stdlib/template"
import "stdlib/test"
import "testing"

# --- TestRenderSimple ---
type RenderSimpleCase
    name string
    template string
    data map of string to any
    want string
    wantErr bool

func TestRenderSimple(t reference testing.T)
    cases := list of RenderSimpleCase{
        RenderSimpleCase{
            name: "renders template with data",
            template: "Hello {{.Name}}",
            data: map of string to any{"Name": "Ari"},
            want: "Hello Ari",
            wantErr: false,
        },
        RenderSimpleCase{
            name: "renders empty template",
            template: "",
            data: map of string to any{},
            want: "",
            wantErr: false,
        },
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            result, err := template.RenderSimple(tc.template, tc.data)
            if tc.wantErr
                test.AssertError(t, err)
            else
                test.AssertNoError(t, err)
                test.AssertEqual(t, result, tc.want)
        )

# --- TestExecute ---
type ExecuteCase
    name string
    template string
    data map of string to any
    want string
    wantErr bool

func TestExecute(t reference testing.T)
    cases := list of ExecuteCase{
        ExecuteCase{
            name: "renders template via builder",
            template: "Greetings {{.Name}}!",
            data: map of string to any{"Name": "Eve"},
            want: "Greetings Eve!",
            wantErr: false,
        },
        ExecuteCase{
            name: "empty template",
            template: "",
            data: map of string to any{},
            want: "",
            wantErr: false,
        },
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            td := template.New()
            td = template.WithContent(td, tc.template)
            td = template.Data(td, tc.data)
            final, err := template.Execute(td)
            if tc.wantErr
                test.AssertError(t, err)
            else
                test.AssertNoError(t, err)
                test.AssertEqual(t, final, tc.want)
        )

# --- TestHTMLRenderSimple ---
type HTMLRenderSimpleCase
    name string
    template string
    data map of string to any
    want string
    wantErr bool

func TestHTMLRenderSimple(t reference testing.T)
    cases := list of HTMLRenderSimpleCase{
        HTMLRenderSimpleCase{
            name: "escapes HTML content",
            template: "<b>{{.Value}}</b>",
            data: map of string to any{"Value": "<script>"},
            want: "<b>&lt;script&gt;</b>",
            wantErr: false,
        },
        HTMLRenderSimpleCase{
            name: "renders plain text",
            template: "Hello {{.Name}}",
            data: map of string to any{"Name": "World"},
            want: "Hello World",
            wantErr: false,
        },
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            result, err := template.HTMLRenderSimple(tc.template, tc.data)
            if tc.wantErr
                test.AssertError(t, err)
            else
                test.AssertNoError(t, err)
                test.AssertEqual(t, result, tc.want)
        )
