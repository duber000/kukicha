# Tests for Kukicha Standard Library - Sandbox Package

petiole sandbox_test

import "stdlib/sandbox"
import "stdlib/test"
import "os"
import "testing"

# --- TestSandboxFileOperations ---
type SandboxCase
    name string

func TestSandboxFileOperations(t reference testing.T)
    cases := list of SandboxCase{
        SandboxCase{name: "file operations"},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            dir, err := os.MkdirTemp("", "sandbox-test")
            test.AssertNoError(t, err)
            defer os.RemoveAll(dir)

            box, err2 := sandbox.New(dir)
            test.AssertNoError(t, err2)
            defer sandbox.Close(box)

            writeErr := sandbox.WriteString(box, "data", "notes.txt")
            test.AssertNoError(t, writeErr)
            test.AssertTrue(t, sandbox.Exists(box, "notes.txt"))

            content, readErr := sandbox.ReadString(box, "notes.txt")
            test.AssertNoError(t, readErr)
            test.AssertEqual(t, content, "data")

            test.AssertTrue(t, sandbox.IsFile(box, "notes.txt"))

            mkdirErr := sandbox.MkDir(box, "subdir")
            test.AssertNoError(t, mkdirErr)
            test.AssertTrue(t, sandbox.IsDir(box, "subdir"))

            names, listErr := sandbox.List(box, ".")
            test.AssertNoError(t, listErr)
            if len(names) == 0
                t.Errorf("List should return at least one entry")

            delErr := sandbox.Delete(box, "notes.txt")
            test.AssertNoError(t, delErr)
            test.AssertFalse(t, sandbox.Exists(box, "notes.txt"))
        )
