# Tests for Kukicha Standard Library - PG Package
# These tests validate the pg module's builder pattern and type construction.
# Full integration tests require a running PostgreSQL instance.

petiole pg_test

import "testing"
import "stdlib/test"
import "stdlib/pg"

# --- TestNewConfig ---
type NewConfigCase
    name string

func TestNewConfig(t reference testing.T)
    cases := list of NewConfigCase{
        NewConfigCase{name: "builder methods"},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            cfg := pg.New("postgres://user:pass@localhost/testdb")
            cfg = cfg |> pg.MaxConns(10) |> pg.MinConns(2)
            _ = cfg
        )

# --- TestMaxConns ---
type MaxConnsCase
    name string

func TestMaxConns(t reference testing.T)
    cases := list of MaxConnsCase{
        MaxConnsCase{name: "max conns"},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            cfg := pg.New("postgres://localhost/test") |> pg.MaxConns(20)
            cfg = cfg |> pg.MinConns(5)
            _ = cfg
        )

# --- TestMaxConnLifetime ---
type LifetimeCase
    name string

func TestMaxConnLifetime(t reference testing.T)
    cases := list of LifetimeCase{
        LifetimeCase{name: "lifetime"},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            cfg := pg.New("postgres://localhost/test") |> pg.MaxConnLifetime(3600000000000)
            cfg = cfg |> pg.MaxConnIdleTime(600000000000)
            _ = cfg
        )

# --- TestRowsAffected ---
type RowsAffectedCase
    name string

func TestRowsAffected(t reference testing.T)
    cases := list of RowsAffectedCase{
        RowsAffectedCase{name: "zero result"},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            r := pg.Result{}
            count := pg.RowsAffected(r)
            test.AssertEqual(t, count, 0 as int64)
        )
