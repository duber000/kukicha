# A2A Package Tests

petiole a2a_test

import "stdlib/a2a"
import "testing"

# Test basic types and structures
func TestBasicTypes(t reference testing.T)
    # Test that we can create basic types
    agent := a2a.Agent{}
    request := a2a.Request{}
    task := a2a.Task{}
    
    # Verify types exist and can be instantiated
    if agent == empty
        t.Error("Expected agent to be non-empty")
    if request == empty
        t.Error("Expected request to be non-empty")
    if task == empty
        t.Error("Expected task to be non-empty")

# Test request builder pattern
func TestRequestBuilder(t reference testing.T)
    # Create a mock agent (we can't test real discovery without network)
    agent := a2a.Agent{}
    
    # Test request builder chain
    req := a2a.New(agent)
    req = a2a.Text(req, "Hello")
    req = a2a.Context(req, "context123")
    req = a2a.Retry(req, 3, 100)
    
    # Verify the request has the expected values
    if req.text != "Hello"
        t.Error("Expected req.text to be 'Hello'")
    if req.contextID != "context123"
        t.Error("Expected req.contextID to be 'context123'")
    if req.retryMaxAttempts != 3
        t.Error("Expected req.retryMaxAttempts to be 3")
    if req.retryDelayMs != 100
        t.Error("Expected req.retryDelayMs to be 100")

# Test Skills function with mock data
func TestSkillsFunction(t reference testing.T)
    # This is a basic test - in a real scenario we'd need to mock the agent card
    # For now, we just test that the function signature is correct
    agent := a2a.Agent{}
    
    # We can't test actual skills without a real agent card
    # But we can verify the function exists and has the right signature
    skillsFunc := a2a.Skills
    if skillsFunc == empty
        t.Error("Expected Skills function to exist")

# Test Close function
func TestCloseFunction(t reference testing.T)
    agent := a2a.Agent{}
    # We can't test actual closing without a real client
    # But we can verify the function exists
    closeFunc := a2a.Close
    if closeFunc == empty
        t.Error("Expected Close function to exist")

# Test helper functions
func TestHelperFunctions(t reference testing.T)
    # Test extractPartsText with empty list
    emptyParts := make(list of a2a.Part, 0)
    result := a2a.extractPartsText(emptyParts)
    if result != ""
        t.Error("Expected extractPartsText to return empty string")
    
    # Test taskFromA2A with empty task
    emptyTask := a2a.Task{}
    taskResult := a2a.taskFromA2A(emptyTask)
    if taskResult == empty
        t.Error("Expected taskFromA2A to return non-empty task")