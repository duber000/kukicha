// Generated by Kukicha v0.0.1 (requires Go 1.25+)
//
// Performance options:
//   GOEXPERIMENT=greenteagc  - Green Tea GC (10-40% faster, default in Go 1.26)
//   GOEXPERIMENT=jsonv2      - Faster JSON parsing (2-10x improvement)

package env

import (
	"errors"
	"fmt"
	kukistring "github.com/duber000/kukicha/stdlib/string"
	"os"
	"strconv"
)

func Get(key string) (string, error) {
	value := os.Getenv(key)
	if value == "" {
		return "", errors.New(fmt.Sprintf("environment variable %v is not set", key))
	}
	return value, nil
}

func GetOr(key string, defaultValue string) string {
	value := os.Getenv(key)
	if value == "" {
		return defaultValue
	}
	return value
}

func GetInt(key string) (int, error) {
	value := os.Getenv(key)
	if value == "" {
		return 0, errors.New(fmt.Sprintf("environment variable %v is not set", key))
	}
	n, err := strconv.Atoi(value)
	if err != nil {
		return 0, errors.New(fmt.Sprintf("environment variable %v is not a valid integer: %v", key, value))
	}
	return n, nil
}

func GetIntOr(key string, defaultValue int) (int, error) {
	value := os.Getenv(key)
	if value == "" {
		return defaultValue, nil
	}
	n, err := strconv.Atoi(value)
	if err != nil {
		return 0, errors.New(fmt.Sprintf("environment variable %v is not a valid integer: %v", key, value))
	}
	return n, nil
}

func GetIntOrDefault(key string, defaultValue int) int {
	value := os.Getenv(key)
	if value == "" {
		return defaultValue
	}
	n, err := strconv.Atoi(value)
	if err != nil {
		return defaultValue
	}
	return n
}

func GetBool(key string) (bool, error) {
	value := os.Getenv(key)
	if value == "" {
		return false, errors.New(fmt.Sprintf("environment variable %v is not set", key))
	}
	return parseBool(key, value)
}

func GetBoolOr(key string, defaultValue bool) (bool, error) {
	value := os.Getenv(key)
	if value == "" {
		return defaultValue, nil
	}
	return parseBool(key, value)
}

func GetBoolOrDefault(key string, defaultValue bool) bool {
	value := os.Getenv(key)
	if value == "" {
		return defaultValue
	}
	result, err := parseBool(key, value)
	if err != nil {
		return defaultValue
	}
	return result
}

func GetFloat(key string) (float64, error) {
	value := os.Getenv(key)
	if value == "" {
		return 0.000000, errors.New(fmt.Sprintf("environment variable %v is not set", key))
	}
	n, err := strconv.ParseFloat(value, 64)
	if err != nil {
		return 0.000000, errors.New(fmt.Sprintf("environment variable %v is not a valid number: %v", key, value))
	}
	return n, nil
}

func GetFloatOr(key string, defaultValue float64) (float64, error) {
	value := os.Getenv(key)
	if value == "" {
		return defaultValue, nil
	}
	n, err := strconv.ParseFloat(value, 64)
	if err != nil {
		return 0.000000, errors.New(fmt.Sprintf("environment variable %v is not a valid number: %v", key, value))
	}
	return n, nil
}

func GetList(key string, separator string) ([]string, error) {
	value := os.Getenv(key)
	if value == "" {
		return []string{}, errors.New(fmt.Sprintf("environment variable %v is not set", key))
	}
	return splitAndTrim(value, separator), nil
}

func GetListOr(key string, separator string, defaultValue []string) []string {
	value := os.Getenv(key)
	if value == "" {
		return defaultValue
	}
	return splitAndTrim(value, separator)
}

func Set(key string, value string) error {
	return os.Setenv(key, value)
}

func Unset(key string) error {
	return os.Unsetenv(key)
}

func IsSet(key string) bool {
	_, exists := os.LookupEnv(key)
	return exists
}

func IsSetAndNotEmpty(key string) bool {
	value, exists := os.LookupEnv(key)
	if !exists {
		return false
	}
	return !(value == "")
}

func All() map[string]string {
	result := make(map[string]string)
	for _, e := range os.Environ() {
		parts := kukistring.SplitN(e, "=", 2)
		if len(parts) == 2 {
			result[parts[0]] = parts[1]
		}
	}
	return result
}

func parseBool(key string, value string) (bool, error) {
	lower := kukistring.ToLower(kukistring.TrimSpace(value))
	if (((lower == "true") || (lower == "1")) || (lower == "yes")) || (lower == "on") {
		return true, nil
	}
	if (((lower == "false") || (lower == "0")) || (lower == "no")) || (lower == "off") {
		return false, nil
	}
	return false, errors.New(fmt.Sprintf("environment variable %v is not a valid boolean: %v", key, value))
}

func splitAndTrim(value string, separator string) []string {
	parts := kukistring.Split(value, separator)
	result := make([]string, 0, len(parts))
	for _, part := range parts {
		trimmed := kukistring.TrimSpace(part)
		if trimmed != "" {
			result = append(result, trimmed)
		}
	}
	return result
}
