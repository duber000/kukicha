# Tests for Kukicha Standard Library - MCP Package

petiole mcp_test

import "stdlib/mcp"
import "github.com/modelcontextprotocol/go-sdk/mcp"
import "testing"

# Test Schema and Required helpers
func TestSchemaHelpers(t reference testing.T)
    props := list of mcp.SchemaProperty{
        {Name: "id", Type: "string", Description: "identifier"},
    }
    schema := mcp.Schema(props)
    if schema["type"] not equals "object"
        t.Errorf("Schema should declare object type")
    properties := schema["properties"] as map of string to any
    if properties["id"] equals empty
        t.Errorf("Schema should include id property")

    result := mcp.Required(schema, list of string{"id"})
    if resMap, ok := result as map of string to any
        if resMap["required"] equals empty
            t.Errorf("Required should add the required field")
    else
        t.Fatalf("Required should return map when schema map provided")

# Test TextResult and ErrorResult shapes
func TestResultHelpers(t reference testing.T)
    text := mcp.TextResult("hello")
    if res, ok := text.(reference mcp.CallToolResult); ok
        if res.IsError
            t.Errorf("TextResult should not mark result as error")
        if res.Content[0].(*mcp.TextContent).Text not equals "hello"
            t.Errorf("TextResult content mismatch")
    else
        t.Fatalf("TextResult should return CallToolResult")

    errRes := mcp.ErrorResult("boom")
    if errResult, ok := errRes.(reference mcp.CallToolResult); ok
        if not errResult.IsError
            t.Errorf("ErrorResult should mark IsError true")
    else
        t.Fatalf("ErrorResult should return CallToolResult")
