// Generated by Kukicha v0.0.1 (requires Go 1.25+)
//
// Performance options:
//   GOEXPERIMENT=greenteagc  - Green Tea GC (10-40% faster, default in Go 1.26)
//   GOEXPERIMENT=jsonv2      - Faster JSON parsing (2-10x improvement)

package json

import (
	jsonv1 "encoding/json"
	json "encoding/json/v2"
	"io"
)

type Encoder struct {
	writer        io.Writer
	deterministic bool
	indent        string
	prefix        string
}

type Decoder struct {
	reader io.Reader
}

func NewEncoder(writer io.Writer) Encoder {
	enc := Encoder{}
	enc.writer = writer
	enc.deterministic = false
	enc.indent = ""
	enc.prefix = ""
	return enc
}

func WithDeterministic(enc Encoder) Encoder {
	enc.deterministic = true
	return enc
}

func WithIndent(enc Encoder, indent string) Encoder {
	enc.indent = indent
	return enc
}

func WithPrefix(enc Encoder, prefix string) Encoder {
	enc.prefix = prefix
	return enc
}

func Encode(enc Encoder, value any) error {
	if enc.deterministic {
		return json.MarshalWrite(enc.writer, value, json.Deterministic(true))
	}
	return json.MarshalWrite(enc.writer, value)
}

func NewDecoder(reader io.Reader) Decoder {
	dec := Decoder{}
	dec.reader = reader
	return dec
}

func Decode(dec Decoder, target any) error {
	return json.UnmarshalRead(dec.reader, target)
}

func Marshal(value any) ([]byte, error) {
	bytes, err := json.Marshal(value)
	return bytes, err
}

func MarshalPretty(value any) ([]byte, error) {
	bytes, err := jsonv1.MarshalIndent(value, "", "  ")
	return bytes, err
}

func Unmarshal(data []byte, target any) error {
	return json.Unmarshal(data, target)
}

func MarshalWrite(writer io.Writer, value any) error {
	return json.MarshalWrite(writer, value)
}

func UnmarshalRead(reader io.Reader, target any) error {
	return json.UnmarshalRead(reader, target)
}
