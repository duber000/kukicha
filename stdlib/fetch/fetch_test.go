// Generated by Kukicha v0.0.10 (requires Go 1.26+)

package fetch_test

import (
	"encoding/json"
	"fmt"
	"github.com/duber000/kukicha/stdlib/fetch"
	"github.com/duber000/kukicha/stdlib/test"
	"net/http"
	"net/http/httptest"
	"testing"
)

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:13
type TestData struct {
	Message string `json:"message"`
	Count   int    `json:"count"`
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:17
type PostData struct {
	Name  string `json:"name"`
	Value int    `json:"value"`
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:22
type GetCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:25
func TestGet(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:29
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:27
		w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:28
		w.Write([]byte("Hello, World!"))
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:30
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:34
	cases := []GetCase{GetCase{name: "basic get"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:35
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:36
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:37
			resp, err := fetch.Get(server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:38
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:39
			test.AssertEqual(t, resp.StatusCode, http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:40
			resp.Body.Close()
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:44
type JsonCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:47
func TestJson(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:48
	testData := TestData{Message: "test", Count: 42}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:49
	jsonBytes, _ := json.Marshal(testData)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:55
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:52
		w.Header().Set("Content-Type", "application/json")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:53
		w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:54
		w.Write(jsonBytes)
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:56
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:60
	cases := []JsonCase{JsonCase{name: "parse object"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:61
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:62
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:63
			resp, err := fetch.Get(server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:64
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:65
			data, jsonErr := fetch.Json(resp, *new(TestData))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:66
			test.AssertNoError(t, jsonErr)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:67
			test.AssertEqual(t, data.Message, "test")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:68
			test.AssertEqual(t, data.Count, 42)
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:72
type JsonArrayCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:75
func TestJsonArray(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:76
	jsonBytes := []byte("[{\"message\":\"a\",\"count\":1},{\"message\":\"b\",\"count\":2}]")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:81
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:78
		w.Header().Set("Content-Type", "application/json")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:79
		w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:80
		w.Write(jsonBytes)
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:82
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:86
	cases := []JsonArrayCase{JsonArrayCase{name: "parse array"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:87
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:88
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:89
			resp, err := fetch.Get(server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:90
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:91
			data, jsonErr := fetch.Json(resp, []TestData{})
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:92
			test.AssertNoError(t, jsonErr)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:93
			test.AssertEqual(t, len(data), 2)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:94
			test.AssertEqual(t, data[0].Message, "a")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:95
			test.AssertEqual(t, data[1].Count, 2)
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:99
type DecodeCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:102
func TestDecode(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:106
	testData := []TestData{TestData{Message: "typed", Count: 7}, TestData{Message: "decode", Count: 9}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:107
	jsonBytes, _ := json.Marshal(testData)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:112
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:109
		w.Header().Set("Content-Type", "application/json")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:110
		w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:111
		w.Write(jsonBytes)
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:113
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:117
	cases := []DecodeCase{DecodeCase{name: "decode into reference"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:118
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:119
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:120
			resp, err := fetch.Get(server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:121
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:122
			decoded := []TestData{}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:123
			decodeErr := fetch.Decode(resp, &decoded)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:124
			test.AssertNoError(t, decodeErr)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:125
			test.AssertEqual(t, len(decoded), 2)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:126
			test.AssertEqual(t, decoded[0].Message, "typed")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:127
			test.AssertEqual(t, decoded[1].Count, 9)
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:131
type URLTemplateCase struct {
	name    string
	tmpl    string
	args    map[string]string
	want    string
	wantErr bool
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:138
func TestURLTemplate(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:139
	tmpl := fmt.Sprintf("https://api.example.com/users/%cusername%c/repos/%crepo%c", 123, 125, 123, 125)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:156
	cases := []URLTemplateCase{URLTemplateCase{name: "success with encoding", tmpl: tmpl, args: map[string]string{"username": "acme/dev team", "repo": "hello world"}, want: "https://api.example.com/users/acme%2Fdev%20team/repos/hello%20world", wantErr: false}, URLTemplateCase{name: "missing placeholder", tmpl: tmpl, args: map[string]string{"username": "golang"}, want: "", wantErr: true}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:157
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:158
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:159
			builtURL, err := fetch.URLTemplate(tc.tmpl, tc.args)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:160
			if tc.wantErr {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:161
				test.AssertError(t, err)
			} else {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:163
				test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:164
				test.AssertEqual(t, builtURL, tc.want)
			}
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:168
type URLWithQueryCase struct {
	name  string
	url   string
	query map[string]string
	want1 string
	want2 string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:175
func TestURLWithQuery(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:184
	cases := []URLWithQueryCase{URLWithQueryCase{name: "encode multiple params", url: "https://api.example.com/search", query: map[string]string{"q": "go lang", "sort": "stars desc"}, want1: "https://api.example.com/search?q=go+lang&sort=stars+desc", want2: "https://api.example.com/search?sort=stars+desc&q=go+lang"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:185
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:186
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:187
			builtURL, err := fetch.URLWithQuery(tc.url, tc.query)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:188
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:189
			if (builtURL != tc.want1) && (builtURL != tc.want2) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:190
				t.Errorf("Unexpected query URL: %v", builtURL)
			}
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:194
type TextCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:197
func TestText(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:198
	expectedText := "Hello, Kukicha!"
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:202
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:200
		w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:201
		w.Write([]byte(expectedText))
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:203
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:207
	cases := []TextCase{TextCase{name: "read as text"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:208
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:209
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:210
			resp, err := fetch.Get(server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:211
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:212
			text, textErr := fetch.Text(resp)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:213
			test.AssertNoError(t, textErr)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:214
			test.AssertEqual(t, text, expectedText)
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:218
type PostCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:221
func TestPost(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:226
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:223
		test.AssertEqual(t, r.Method, "POST")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:224
		w.WriteHeader(http.StatusCreated)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:225
		w.Write([]byte("created"))
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:227
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:231
	cases := []PostCase{PostCase{name: "post object"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:232
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:233
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:234
			postData := PostData{Name: "test", Value: 123}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:235
			resp, err := fetch.Post(postData, server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:236
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:237
			test.AssertEqual(t, resp.StatusCode, http.StatusCreated)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:238
			resp.Body.Close()
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:242
type CheckStatusCase struct {
	name    string
	code    int
	wantErr bool
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:247
func TestCheckStatus(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:253
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:249
		if r.URL.Path == "/ok" {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:250
			w.WriteHeader(http.StatusOK)
		} else {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:252
			w.WriteHeader(http.StatusNotFound)
		}
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:254
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:259
	cases := []CheckStatusCase{CheckStatusCase{name: "success status", code: 200, wantErr: false}, CheckStatusCase{name: "error status", code: 404, wantErr: true}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:260
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:261
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:262
			path := "/ok"
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:263
			if tc.wantErr {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:264
				path = "/notfound"
			}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:265
			resp, err := fetch.Get((server.URL + path))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:266
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:268
			checkedResp, checkErr := fetch.CheckStatus(resp)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:269
			if tc.wantErr {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:270
				test.AssertError(t, checkErr)
			} else {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:272
				test.AssertNoError(t, checkErr)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:273
				if checkedResp == nil {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:274
					t.Error("Expected non-nil response")
				}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:275
				checkedResp.Body.Close()
			}
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:279
type RequestBuilderCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:282
func TestRequestBuilder(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:287
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:284
		test.AssertEqual(t, r.Header.Get("Authorization"), "Bearer test-token")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:285
		w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:286
		w.Write([]byte("authorized"))
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:288
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:292
	cases := []RequestBuilderCase{RequestBuilderCase{name: "builder properties"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:293
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:294
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:295
			req := fetch.Header(fetch.New(server.URL), "Authorization", "Bearer test-token")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:296
			resp, err := fetch.Do(req)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:297
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:298
			test.AssertEqual(t, resp.StatusCode, http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:299
			resp.Body.Close()
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:303
type AuthHelpersCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:306
func TestAuthHelpers(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:309
	cases := []AuthHelpersCase{AuthHelpersCase{name: "auth headers"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:310
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:311
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:315
			serverBearer := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:313
				test.AssertEqual(t, r.Header.Get("Authorization"), "Bearer my-token")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:314
				w.WriteHeader(http.StatusOK)
			}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:316
			defer serverBearer.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:318
			reqBearer := fetch.BearerAuth(fetch.New(serverBearer.URL), "my-token")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:319
			respBearer, errBearer := fetch.Do(reqBearer)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:320
			test.AssertNoError(t, errBearer)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:321
			respBearer.Body.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:326
			serverBasic := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:324
				test.AssertEqual(t, r.Header.Get("Authorization"), "Basic dXNlcjpwYXNz")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:325
				w.WriteHeader(http.StatusOK)
			}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:327
			defer serverBasic.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:329
			reqBasic := fetch.BasicAuth(fetch.New(serverBasic.URL), "user", "pass")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:330
			respBasic, errBasic := fetch.Do(reqBasic)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:331
			test.AssertNoError(t, errBasic)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:332
			respBasic.Body.Close()
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:336
type FormDataCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:339
func TestFormData(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:345
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:341
		test.AssertEqual(t, r.Header.Get("Content-Type"), "application/x-www-form-urlencoded")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:342
		r.ParseForm()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:343
		test.AssertEqual(t, r.Form.Get("key"), "value")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:344
		w.WriteHeader(http.StatusOK)
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:346
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:350
	cases := []FormDataCase{FormDataCase{name: "post form data"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:351
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:352
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:353
			data := map[string]string{"key": "value"}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:354
			req := fetch.Method(fetch.FormData(fetch.New(server.URL), data), "POST")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:355
			resp, err := fetch.Do(req)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:356
			test.AssertNoError(t, err)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:357
			resp.Body.Close()
		})
	}
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:361
type SessionCase struct {
	name string
}

//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:364
func TestSession(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:375
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:366
		cookie, err := r.Cookie("session_id")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:367
		if err == nil {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:368
			test.AssertEqual(t, cookie.Value, "12345")
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:369
			w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:370
			w.Write([]byte("logged in"))
		} else {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:372
			http.SetCookie(w, &http.Cookie{Name: "session_id", Value: "12345"})
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:373
			w.WriteHeader(http.StatusOK)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:374
			w.Write([]byte("cookie set"))
		}
	}))
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:376
	defer server.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:380
	cases := []SessionCase{SessionCase{name: "persist cookies"}}
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:381
	for _, tc := range cases {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:382
		t.Run(tc.name, func(t *testing.T) {
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:383
			session := fetch.NewSession()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:384
			resp1, err1 := fetch.SessionGet(session, server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:385
			test.AssertNoError(t, err1)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:386
			resp1.Body.Close()
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:388
			resp2, err2 := fetch.SessionGet(session, server.URL)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:389
			test.AssertNoError(t, err2)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:390
			text, errText := fetch.Text(resp2)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:391
			test.AssertNoError(t, errText)
//line /home/user/kukicha/stdlib/fetch/fetch_test.kuki:392
			test.AssertEqual(t, text, "logged in")
		})
	}
}
