# CLI Package Tests

petiole cli_test

import "stdlib/cli"
import "testing"

# Test basic CLI parsing (this is hard to test without mocking os.Args)
# We test the helper functions instead

func TestFlagHelpers(t reference testing.T)
    flags := make(map of string to string)
    flags["verbose"] = "true"
    flags["count"] = "42"
    flags["mode"] = "fast"
    
    # Test Flag
    if cli.Flag(flags, "mode") != "fast"
        t.Error("Expected Flag('mode') to be 'fast'")
    
    # Test BoolFlag
    if not cli.BoolFlag(flags, "verbose")
        t.Error("Expected BoolFlag('verbose') to be true")
    
    # Test IntFlag
    val, err := cli.IntFlag(flags, "count")
    if err != empty or val != 42
        t.Error("Expected IntFlag('count') to be 42")
    
    _, missingErr := cli.IntFlag(flags, "missing")
    if missingErr == empty
        t.Error("Expected error for missing int flag")

func TestStringHelper(t reference testing.T)
    flags := make(map of string to string)
    flags["format"] = "json"
    
    positional := make(list of string)
    positional = append(positional, "input.txt")
    positional = append(positional, "output.txt")
    
    # Test String with flag
    if cli.String(flags, positional, "format") != "json"
        t.Error("Expected String('format') to be 'json'")
    
    # Test String with positional index
    # Note: cli.String uses strconv.Atoi on the name if not found in flags
    if cli.String(flags, positional, "0") != "input.txt"
        t.Error("Expected String('0') to be 'input.txt'")
    
    if cli.String(flags, positional, "1") != "output.txt"
        t.Error("Expected String('1') to be 'output.txt'")

func TestCommandHelper(t reference testing.T)
    positional := make(list of string)
    positional = append(positional, "build")
    positional = append(positional, "main.kuki")
    
    if cli.Command(positional) != "build"
        t.Error("Expected Command() to be 'build'")
    
    emptyPos := make(list of string)
    if cli.Command(emptyPos) != ""
        t.Error("Expected Command() to be empty for no positional args")
