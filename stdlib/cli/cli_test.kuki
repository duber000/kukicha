# CLI Package Tests

petiole cli_test

import "stdlib/cli"
import "testing"

# Test GetString helper
func TestGetString(t reference testing.T)
    args := cli.Args{
        Positional: list of string{"build", "main.kuki"},
        Flags: map of string to string{
            "format": "json",
            "output": "result.txt",
        },
    }

    # Test getting flag value
    format := cli.GetString(args, "format")
    if format != "json"
        t.Errorf("Expected format to be 'json', got '{format}'")

    # Test getting another flag
    output := cli.GetString(args, "output")
    if output != "result.txt"
        t.Errorf("Expected output to be 'result.txt', got '{output}'")

    # Test missing flag returns empty string
    missing := cli.GetString(args, "missing")
    if missing != ""
        t.Errorf("Expected missing flag to return empty string, got '{missing}'")

# Test GetBool helper
func TestGetBool(t reference testing.T)
    args := cli.Args{
        Positional: list of string{},
        Flags: map of string to string{
            "verbose": "true",
            "quiet": "false",
            "debug": "yes",
        },
    }

    # Test true value
    verbose := cli.GetBool(args, "verbose")
    if not verbose
        t.Error("Expected verbose to be true")

    # Test false value
    quiet := cli.GetBool(args, "quiet")
    if quiet
        t.Error("Expected quiet to be false")

    # Test non-standard true value
    debug := cli.GetBool(args, "debug")
    if not debug
        t.Error("Expected debug to be true")

    # Test missing flag returns false
    missing := cli.GetBool(args, "missing")
    if missing
        t.Error("Expected missing flag to return false")

# Test GetInt helper
func TestGetInt(t reference testing.T)
    args := cli.Args{
        Positional: list of string{},
        Flags: map of string to string{
            "count": "42",
            "port": "8080",
            "invalid": "not-a-number",
        },
    }

    # Test valid int
    count := cli.GetInt(args, "count")
    if count != 42
        t.Errorf("Expected count to be 42, got {count}")

    # Test another valid int
    port := cli.GetInt(args, "port")
    if port != 8080
        t.Errorf("Expected port to be 8080, got {port}")

    # Test invalid int returns 0
    invalid := cli.GetInt(args, "invalid")
    if invalid != 0
        t.Errorf("Expected invalid int to return 0, got {invalid}")

    # Test missing flag returns 0
    missing := cli.GetInt(args, "missing")
    if missing != 0
        t.Errorf("Expected missing flag to return 0, got {missing}")

# Test positional arguments
func TestPositionalArgs(t reference testing.T)
    args := cli.Args{
        Positional: list of string{"command", "arg1", "arg2", "arg3"},
        Flags: map of string to string{},
    }

    # Test accessing positional arguments
    if len(args.Positional) != 4
        t.Errorf("Expected 4 positional args, got {len(args.Positional)}")

    if args.Positional[0] != "command"
        t.Errorf("Expected first arg to be 'command', got '{args.Positional[0]}'")

    if args.Positional[1] != "arg1"
        t.Errorf("Expected second arg to be 'arg1', got '{args.Positional[1]}'")
