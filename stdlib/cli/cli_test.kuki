# CLI Package Tests

petiole cli_test

import "stdlib/cli"
import "testing"

# Helper to create Args with values
func makeArgs(values map of string to string) cli.Args
    return cli.NewArgs(values)

# Test GetString helper
func TestGetString(t reference testing.T)
    values := make(map of string to string)
    values["format"] = "json"
    values["output"] = "result.txt"
    values["input"] = "main.kuki"

    args := makeArgs(values)

    # Test getting value
    format := cli.GetString(args, "format")
    if format != "json"
        t.Error("Expected format to be 'json'")

    # Test getting another value
    output := cli.GetString(args, "output")
    if output != "result.txt"
        t.Error("Expected output to be 'result.txt'")

    # Test missing value returns empty string
    missing := cli.GetString(args, "missing")
    if missing != ""
        t.Error("Expected missing value to return empty string")

# Test GetBool helper
func TestGetBool(t reference testing.T)
    values := make(map of string to string)
    values["verbose"] = "true"
    values["quiet"] = "false"
    values["debug"] = "yes"
    values["enabled"] = "1"

    args := makeArgs(values)

    # Test true value
    verbose := cli.GetBool(args, "verbose")
    if not verbose
        t.Error("Expected verbose to be true")

    # Test false value
    quiet := cli.GetBool(args, "quiet")
    if quiet
        t.Error("Expected quiet to be false")

    # Test non-standard true value "yes"
    debug := cli.GetBool(args, "debug")
    if not debug
        t.Error("Expected debug to be true")

    # Test non-standard true value "1"
    enabled := cli.GetBool(args, "enabled")
    if not enabled
        t.Error("Expected enabled to be true")

    # Test missing flag returns false
    missing := cli.GetBool(args, "missing")
    if missing
        t.Error("Expected missing flag to return false")

# Test GetInt helper
func TestGetInt(t reference testing.T)
    values := make(map of string to string)
    values["count"] = "42"
    values["port"] = "8080"
    values["invalid"] = "not-a-number"

    args := makeArgs(values)

    # Test valid int
    count, countErr := cli.GetInt(args, "count")
    if countErr != empty
        t.Error("Expected no error for count")
    if count != 42
        t.Error("Expected count to be 42")

    # Test another valid int
    port, portErr := cli.GetInt(args, "port")
    if portErr != empty
        t.Error("Expected no error for port")
    if port != 8080
        t.Error("Expected port to be 8080")

    # Test invalid int returns error
    invalid, invalidErr := cli.GetInt(args, "invalid")
    if invalidErr == empty
        t.Error("Expected error for invalid int")
    if invalid != 0
        t.Error("Expected invalid int to return 0")

    # Test missing returns error
    missing, missingErr := cli.GetInt(args, "missing")
    if missingErr == empty
        t.Error("Expected error for missing value")
    if missing != 0
        t.Error("Expected missing value to return 0")
