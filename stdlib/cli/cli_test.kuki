# CLI Package Tests

petiole cli_test

import "stdlib/cli"
import "stdlib/test"
import "testing"

# --- TestGetString ---
type GetStringCase
    name  string
    key   string
    want  string

func TestGetString(t reference testing.T)
    values := make(map of string to string)
    values["format"] = "json"
    values["output"] = "result.txt"
    values["input"] = "main.kuki"
    args := cli.NewArgs(values)

    cases := list of GetStringCase{
        GetStringCase{name: "existing key 1", key: "format", want: "json"},
        GetStringCase{name: "existing key 2", key: "output", want: "result.txt"},
        GetStringCase{name: "missing key", key: "missing", want: ""},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            got := cli.GetString(args, tc.key)
            test.AssertEqual(t, got, tc.want)
        )

# --- TestGetBool ---
type GetBoolCase
    name string
    key  string
    want bool

func TestGetBool(t reference testing.T)
    values := make(map of string to string)
    values["verbose"] = "true"
    values["quiet"] = "false"
    values["debug"] = "yes"
    values["enabled"] = "1"
    args := cli.NewArgs(values)

    cases := list of GetBoolCase{
        GetBoolCase{name: "true string", key: "verbose", want: true},
        GetBoolCase{name: "false string", key: "quiet", want: false},
        GetBoolCase{name: "yes string", key: "debug", want: true},
        GetBoolCase{name: "1 string", key: "enabled", want: true},
        GetBoolCase{name: "missing flag", key: "missing", want: false},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            got := cli.GetBool(args, tc.key)
            test.AssertEqual(t, got, tc.want)
        )

# --- TestGetInt ---
type GetIntCase
    name    string
    key     string
    want    int
    wantErr bool

func TestGetInt(t reference testing.T)
    values := make(map of string to string)
    values["count"] = "42"
    values["port"] = "8080"
    values["invalid"] = "not-a-number"
    args := cli.NewArgs(values)

    cases := list of GetIntCase{
        GetIntCase{name: "valid int 1", key: "count", want: 42, wantErr: false},
        GetIntCase{name: "valid int 2", key: "port", want: 8080, wantErr: false},
        GetIntCase{name: "invalid int", key: "invalid", want: 0, wantErr: true},
        GetIntCase{name: "missing value", key: "missing", want: 0, wantErr: true},
    }
    for tc in cases
        t.Run(tc.name, (t reference testing.T) =>
            got, err := cli.GetInt(args, tc.key)
            if tc.wantErr
                test.AssertError(t, err)
            else
                test.AssertNoError(t, err)
                test.AssertEqual(t, got, tc.want)
        )
