# Tests for Kukicha Standard Library - Must Package

petiole must_test

import "stdlib/must"
import "os"
import "testing"

# Test Do returns the value when no error
func TestDoWithoutError(t reference testing.T)
    value := must.Do("ok", empty)
    if value != "ok"
        t.Errorf("Do should return value when err empty")

# Test Ok succeeds when error is empty
func TestOkWithoutError(t reference testing.T)
    must.Ok(empty)
    must.OkMsg(empty, "fine")
    # No panic = success
    t.Logf("Ok and OkMsg succeeded with empty error")

# Test environment helpers use os env
func TestEnvHelpers(t reference testing.T)
    os.Setenv("MUST_TEST", "value")
    value := must.Env("MUST_TEST")
    if value != "value"
        t.Errorf("Env should return set value")

    valueOr := must.EnvOr("MUST_TEST", "default")
    if valueOr != "value"
        t.Errorf("EnvOr should prefer actual env")

    os.Unsetenv("MUST_TEST")
    defaultValue := must.EnvOr("MUST_TEST", "default")
    if defaultValue != "default"
        t.Errorf("EnvOr should fall back to default when env missing")

# Test assertion helpers succeed on valid conditions
func TestAssertionHelpers(t reference testing.T)
    must.True(true, "ok")
    must.False(false, "ok")
    must.NotEmpty("x", "name")
    must.NotNil("value", "value")
    # No panic = success
    t.Logf("All assertion helpers succeeded with valid conditions")
